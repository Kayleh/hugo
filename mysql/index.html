<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Kayleh">
  
  
  
  <link rel="prev" href="https://kayleh.top/http/" />
  <link rel="next" href="https://kayleh.top/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%841/" />
  <link rel="canonical" href="https://kayleh.top/mysql/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  
  <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/9e961453.js","daovoice")</script>
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           MYSQL | Kayleh
       
  </title>
  <meta name="title" content="MYSQL | Kayleh">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/kayleh.top"
    },
    "articleSection" : "posts",
    "name" : "MYSQL",
    "headline" : "MYSQL",
    "description" : "\u003ch1 id=\u0022mysql索引\u0022\u003eMYSQL索引\u003c\/h1\u003e",
    "inLanguage" : "en-us",
    "author" : "Kayleh",
    "creator" : "Kayleh",
    "publisher": "Kayleh",
    "accountablePerson" : "Kayleh",
    "copyrightHolder" : "Kayleh",
    "copyrightYear" : "2020",
    "datePublished": "2020-08-02 22:54:25 \u002b0800 CST",
    "dateModified" : "2020-08-02 22:54:25 \u002b0800 CST",
    "url" : "https:\/\/kayleh.top\/mysql\/",
    "wordCount" : "1275",
    "keywords" : [ "sql", "Kayleh"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/" title="">Home</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/" title="">Home</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">MYSQL</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://kayleh.top" rel="author">Kayleh</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-08-02 itemprop="datePublished">August 2, 2020</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <h1 id="mysql索引">MYSQL索引</h1>
<blockquote>
<p>MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。</p>
<p>打个比方，如果合理的设计且使用索引的MySQL是一辆兰博基尼的话，那么没有设计和使用索引的MySQL就是一个人力三轮车。</p>
<p>拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。</p>
<p>索引分单列索引和组合索引。单列索引，即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引。组合索引，即一个索引包含多个列。</p>
<p>创建索引时，你需要确保该索引是应用在 SQL 查询语句的条件(一般作为 WHERE 子句的条件)。</p>
<p>实际上，索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录。</p>
<p>上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。</p>
<p>建立索引会占用磁盘空间的索引文件。</p>
</blockquote>
<h2 id="普通索引">普通索引</h2>
<h3 id="创建索引">创建索引</h3>
<p>这是最基本的索引，它没有任何限制。它有以下几种创建方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">INDEX</span> indexName <span style="color:#66d9ef">ON</span> <span style="color:#a6e22e">mytable</span>(<span style="color:#a6e22e">username</span>(length)); 
</code></pre></div><p>如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。</p>
<h3 id="修改表结构添加索引">修改表结构(添加索引)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">table</span> tableName <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#a6e22e">indexName</span>(columnName)
</code></pre></div><h3 id="创建表的时候直接指定">创建表的时候直接指定</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">mytable</span>(  
 
ID <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,   
 
username <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">16</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,  
 
<span style="color:#66d9ef">INDEX</span> [indexName] (<span style="color:#a6e22e">username</span>(length))  
 
);  
</code></pre></div><h3 id="删除索引的语法">删除索引的语法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> [indexName] <span style="color:#66d9ef">ON</span> mytable; 
</code></pre></div><h2 id="唯一索引">唯一索引</h2>
<p>它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。它有以下几种创建方式：</p>
<h3 id="创建索引-1">创建索引</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">INDEX</span> indexName <span style="color:#66d9ef">ON</span> <span style="color:#a6e22e">mytable</span>(<span style="color:#a6e22e">username</span>(length)) 
</code></pre></div><h3 id="修改表结构">修改表结构</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">table</span> mytable <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">UNIQUE</span> [indexName] (<span style="color:#a6e22e">username</span>(length))
</code></pre></div><h3 id="创建表的时候直接指定-1">创建表的时候直接指定</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">mytable</span>(  
 
ID <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,   
 
username <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">16</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,  
    
<span style="color:#66d9ef">UNIQUE</span> [indexName] (<span style="color:#a6e22e">username</span>(length))  
 
);  
</code></pre></div><h3 id="使用alter-命令添加和删除索引">使用ALTER 命令添加和删除索引</h3>
<p>有四种方式来添加数据表的索引：</p>
<ul>
<li>
<p><strong>ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):</strong></p>
<p>该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。</p>
</li>
<li>
<p><strong>ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):</strong></p>
<p>这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。</p>
</li>
<li>
<p><strong>ALTER TABLE tbl_name ADD INDEX index_name (column_list):</strong></p>
<p>添加普通索引，索引值可出现多次。</p>
</li>
<li>
<p><strong>ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):</strong></p>
<p>该语句指定了索引为 FULLTEXT ，用于全文索引。</p>
</li>
</ul>
<p>以下实例为在表中添加索引。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> testalter_tbl <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">INDEX</span> (c);
</code></pre></div><p>你还可以在 ALTER 命令中使用 DROP 子句来删除索引。尝试以下实例删除索引:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> testalter_tbl <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> c;
</code></pre></div><hr>
<h3 id="使用-alter-命令添加和删除主键">使用 ALTER 命令添加和删除主键</h3>
<p>主键只能作用于一个列上，添加主键索引时，你需要确保该主键默认不为空（NOT NULL）。实例如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> testalter_tbl MODIFY i <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> testalter_tbl <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (i);
</code></pre></div><p>你也可以使用 ALTER 命令删除主键：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> testalter_tbl <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>;
</code></pre></div><p>删除主键时只需指定PRIMARY KEY，但在删除索引时，你必须知道索引名。</p>
<hr>
<h3 id="显示索引信息">显示索引信息</h3>
<p>你可以使用 SHOW INDEX 命令来列出表中的相关的索引信息。可以通过添加 \G 来格式化输出信息。</p>
<p>尝试以下实例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> table_name; <span style="color:#960050;background-color:#1e0010">\</span>G
........
</code></pre></div><h1 id="mysql-临时表">MySQL 临时表</h1>
<blockquote>
<p>MySQL 临时表在我们需要保存一些临时数据时是非常有用的。临时表只在当前连接可见，当关闭连接时，Mysql会自动删除表并释放所有空间。临时表在MySQL 3.23版本中添加，如果你的MySQL版本低于 3.23版本就无法使用MySQL的临时表。不过现在一般很少有再使用这么低版本的MySQL数据库服务了。</p>
<p>MySQL临时表只在当前连接可见，如果你使用PHP脚本来创建MySQL临时表，那每当PHP脚本执行完成后，该临时表也会自动销毁。</p>
<p>如果你使用了其他MySQL客户端程序连接MySQL数据库服务器来创建临时表，那么只有在关闭客户端程序时才会销毁临时表，当然你也可以手动销毁。</p>
</blockquote>
<h4 id="实例">实例</h4>
<p>以下展示了使用MySQL 临时表的简单实例，以下的SQL代码可以适用于PHP脚本的mysql_query()函数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> TEMPORARY <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">SalesSummary</span> (
    <span style="color:#f92672">-&gt;</span> product_name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
    <span style="color:#f92672">-&gt;</span> , total_sales <span style="color:#66d9ef">DECIMAL</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>
    <span style="color:#f92672">-&gt;</span> , avg_unit_price <span style="color:#66d9ef">DECIMAL</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>
    <span style="color:#f92672">-&gt;</span> , total_units_sold <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">UNSIGNED</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>
);
Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> SalesSummary
    <span style="color:#f92672">-&gt;</span> (product_name, total_sales, avg_unit_price, total_units_sold)
    <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">VALUES</span>
    <span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;cucumber&#39;</span>, <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">2</span>);

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> SalesSummary;
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#f92672">|</span> product_name <span style="color:#f92672">|</span> total_sales <span style="color:#f92672">|</span> avg_unit_price <span style="color:#f92672">|</span> total_units_sold <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#f92672">|</span> cucumber     <span style="color:#f92672">|</span>      <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">25</span> <span style="color:#f92672">|</span>          <span style="color:#ae81ff">90</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>                <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#ae81ff">1</span> row <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>当你使用 <strong>SHOW TABLES</strong>命令显示数据表列表时，你将无法看到 SalesSummary表。</p>
<p>如果你退出当前MySQL会话，再使用 <strong>SELECT</strong>命令来读取原先创建的临时表数据，那你会发现数据库中没有该表的存在，因为在你退出时该临时表已经被销毁了。</p>
<h2 id="删除mysql-临时表">删除MySQL 临时表</h2>
<p>默认情况下，当你断开与数据库的连接后，临时表就会自动被销毁。当然你也可以在当前MySQL会话使用 <strong>DROP TABLE</strong> 命令来手动删除临时表。</p>
<p>以下是手动删除临时表的实例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> TEMPORARY <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">SalesSummary</span> (
    <span style="color:#f92672">-&gt;</span> product_name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
    <span style="color:#f92672">-&gt;</span> , total_sales <span style="color:#66d9ef">DECIMAL</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>
    <span style="color:#f92672">-&gt;</span> , avg_unit_price <span style="color:#66d9ef">DECIMAL</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span>
    <span style="color:#f92672">-&gt;</span> , total_units_sold <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">UNSIGNED</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>
);
Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> SalesSummary
    <span style="color:#f92672">-&gt;</span> (product_name, total_sales, avg_unit_price, total_units_sold)
    <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">VALUES</span>
    <span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;cucumber&#39;</span>, <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">2</span>);

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> SalesSummary;
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#f92672">|</span> product_name <span style="color:#f92672">|</span> total_sales <span style="color:#f92672">|</span> avg_unit_price <span style="color:#f92672">|</span> total_units_sold <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#f92672">|</span> cucumber     <span style="color:#f92672">|</span>      <span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">25</span> <span style="color:#f92672">|</span>          <span style="color:#ae81ff">90</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>                <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------+-------------+----------------+------------------+</span>
<span style="color:#ae81ff">1</span> row <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> SalesSummary;
mysql<span style="color:#f92672">&gt;</span>  <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> SalesSummary;
ERROR <span style="color:#ae81ff">1146</span>: <span style="color:#66d9ef">Table</span> <span style="color:#e6db74">&#39;RUNOOB.SalesSummary&#39;</span> doesn<span style="color:#e6db74">&#39;t exist
</span></code></pre></div><h2 id="mysql-复制表">MySQL 复制表</h2>
<p>如果我们需要完全的复制MySQL的数据表，包括表的结构，索引，默认值等。 如果仅仅使用<strong>CREATE TABLE &hellip; SELECT</strong> 命令，是无法实现的。</p>
<p>本章节将为大家介绍如何完整的复制MySQL数据表，步骤如下：</p>
<ul>
<li>使用 <strong>SHOW CREATE TABLE</strong> 命令获取创建数据表(<strong>CREATE TABLE</strong>) 语句，该语句包含了原数据表的结构，索引等。</li>
<li></li>
<li>复制以下命令显示的SQL语句，修改数据表名，并执行SQL语句，通过以上命令 将完全的复制数据表结构。</li>
<li>如果你想复制表的内容，你就可以使用 <strong>INSERT INTO &hellip; SELECT</strong> 语句来实现。</li>
</ul>
<h3 id="实例-1">实例</h3>
<p>尝试以下实例来复制表 runoob_tbl 。</p>
<p><strong>步骤一：</strong></p>
<p>获取数据表的完整结构。</p>
<pre><code>mysql&gt; SHOW CREATE TABLE runoob_tbl \G;
*************************** 1. row ***************************
       Table: runoob_tbl
Create Table: CREATE TABLE `runoob_tbl` (
  `runoob_id` int(11) NOT NULL auto_increment,
  `runoob_title` varchar(100) NOT NULL default '',
  `runoob_author` varchar(40) NOT NULL default '',
  `submission_date` date default NULL,
  PRIMARY KEY  (`runoob_id`),
  UNIQUE KEY `AUTHOR_INDEX` (`runoob_author`)
) ENGINE=InnoDB 
1 row in set (0.00 sec)

ERROR:
No query specified
</code></pre><p><strong>步骤二：</strong></p>
<p>修改SQL语句的数据表名，并执行SQL语句。</p>
<pre><code>mysql&gt; CREATE TABLE `clone_tbl` (
  -&gt; `runoob_id` int(11) NOT NULL auto_increment,
  -&gt; `runoob_title` varchar(100) NOT NULL default '',
  -&gt; `runoob_author` varchar(40) NOT NULL default '',
  -&gt; `submission_date` date default NULL,
  -&gt; PRIMARY KEY  (`runoob_id`),
  -&gt; UNIQUE KEY `AUTHOR_INDEX` (`runoob_author`)
-&gt; ) ENGINE=InnoDB;
Query OK, 0 rows affected (1.80 sec)
</code></pre><p><strong>步骤三：</strong></p>
<p>执行完第二步骤后，你将在数据库中创建新的克隆表 clone_tbl。 如果你想拷贝数据表的数据你可以使用 <strong>INSERT INTO&hellip; SELECT</strong> 语句来实现。</p>
<pre><code>mysql&gt; INSERT INTO clone_tbl (runoob_id,
    -&gt;                        runoob_title,
    -&gt;                        runoob_author,
    -&gt;                        submission_date)
    -&gt; SELECT runoob_id,runoob_title,
    -&gt;        runoob_author,submission_date
    -&gt; FROM runoob_tbl;
Query OK, 3 rows affected (0.07 sec)
Records: 3  Duplicates: 0  Warnings: 0
</code></pre><p>执行以上步骤后，你将完整的复制表，包括表结构及表数据。</p>
<h3 id="另一种完整复制表的方法">另一种完整复制表的方法:</h3>
<pre><code>CREATE TABLE targetTable LIKE sourceTable;
INSERT INTO targetTable SELECT * FROM sourceTable;
</code></pre><p>其他:</p>
<p>可以拷贝一个表中其中的一些字段:</p>
<pre><code>CREATE TABLE newadmin AS
(
    SELECT username, password FROM admin
)
</code></pre><p>可以将新建的表的字段改名:</p>
<pre><code>CREATE TABLE newadmin AS
(  
    SELECT id, username AS uname, password AS pass FROM admin
)
</code></pre><p>可以拷贝一部分数据:</p>
<pre><code>CREATE TABLE newadmin AS
(
    SELECT * FROM admin WHERE LEFT(username,1) = 's'
)
</code></pre><p>可以在创建表的同时定义表中的字段信息:</p>
<pre><code>CREATE TABLE newadmin
(
    id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY
)
AS
(
    SELECT * FROM admin
)  
</code></pre><p><strong>区分下mysql复制表的两种方式。</strong></p>
<p><strong>第一、只复制表结构到新表</strong></p>
<p>create table 新表 select * from 旧表 where 1=2</p>
<p>或者</p>
<p>create table 新表 like 旧表</p>
<p><strong>第二、复制表结构及数据到新表</strong></p>
<p>create table新表 select * from 旧表</p>
<h1 id="主要配置文件">主要配置文件</h1>
<h3 id="二进制文件日志log-bin">二进制文件日志log-bin</h3>
<p>主从复制</p>
<h3 id="错误日志log-error">错误日志log-error</h3>
<p>默认是关闭的,记录严重的警告和错误信息,每次启动和关闭的详细信息等</p>
<h3 id="查询日志log">查询日志log</h3>
<p>默认关闭,记录查询的sql语句,如果开启会减低mysql的整体性能,因为记录日志也是需要消耗系统资源的</p>
<h3 id="数据文件">数据文件</h3>
<h5 id="库">库</h5>
<p>默认路径: /var/lib/mysql</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/3.png" alt="1595839986393"></p>
<h5 id="frm文件">frm文件</h5>
<p>存放表结构</p>
<h5 id="myd文件">MYD文件</h5>
<p>存放的是数据,DATA</p>
<h5 id="myi文件">MYI文件</h5>
<p>存放的是查找数据的索引,INDEX</p>
<h2 id="逻辑结构">逻辑结构</h2>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/85282.png" alt="1595842885282"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595843892063.png" alt="1595843892063"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595843971185.png" alt="1595843971185"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595844045065.png" alt="1595844045065"></p>
<h3 id="存储引擎">存储引擎</h3>
<pre><code>show enigines
</code></pre><p>查看mysql当前默认的存储引擎</p>
<pre><code>show variable like '%storage_engine%'
</code></pre><h4 id="myisam和innodb区别">MyisAm和InnoDB区别</h4>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/384514.png" alt="1595844384514"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/49986.png" alt="1595844849986"></p>
<h3 id="sql执行加载顺序">SQL执行加载顺序</h3>
<p>手写</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595988597583.png" alt="1595988597583"></p>
<p>机读</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595988626819.png" alt="1595988626819"></p>
<h1 id="索引">索引</h1>
<blockquote>
<p>MYSQL官方对索引的定义：索引(Index)是帮助MYSQL高效获取数据的数据结构.可以得到索引的本质:索引就是数据结构.</p>
<p>&ldquo;排好序的快速查找数据结构&rdquo;  对排序和查找都有影响</p>
<ul>
<li>
<p>在数据之外,数据库系统还维护着满足特定查找算法的数据结构,这些数据结构以某种方式引用(指向)数据.</p>
<p>这样可以在这些数据结构上实现高级查找算法.这种数据结构,就是索引.下图就是一种可能的索引方式示例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595905536134.png" alt="1595905536134"></p>
</li>
</ul>
<p>索引的目的在于提高查找效率,可以类比字典;</p>
<p>一般来说索引本身也很大,不可能全部存储在内存中,因此索引往往以索引文件的形式存储的磁盘上</p>
<p>我们平常所说的索引,如果没有特别指明,都是指b+树(多路搜索树,并不一定是二叉的)结构组织的索引,其中聚集索引,次要索引,覆盖索引,复合索引,前缀索引,唯一索引默认都是使用B+树索引,统称索引.当然,除了B+树这种类型的索引之外,还有哈希索引(hash index)等</p>
</blockquote>
<h4 id="索引优势">索引优势</h4>
<p>类似大学图书馆建书目索引,提高数据检索的效率,降低数据库的IO成本,通过索引对数据进行排序,降低数据排序的成本,降低了CPU的消耗.</p>
<h4 id="劣势">劣势</h4>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595911864015.png" alt="1595911864015"></p>
<h4 id="索引的分类">索引的分类</h4>
<h5 id="单值索引">单值索引</h5>
<p>即一个索引只包含单个列，一个表可以有多个单列索引</p>
<h5 id="唯一索引-1">唯一索引</h5>
<p>索引列的值必须唯一，但允许有空值</p>
<h5 id="复合索引">复合索引</h5>
<p>即一个索引包含多个列</p>
<h3 id="索引的命名语句">索引的命名语句</h3>
<h4 id="创建">创建</h4>
<blockquote>
<p>CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length));</p>
<p>ALTER mytable ADD [UNIQUE] INDEX [indexName] ON (columnname(name));</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595920057502.png" alt="1595920057502"></p>
<h4 id="删除">删除</h4>
<blockquote>
<p>DROP INDEX [indexName] ON mytable;</p>
</blockquote>
<h4 id="查看">查看</h4>
<blockquote>
<p>SHOW INDEX FROM table_name\G</p>
</blockquote>
<p>使用ALTER命令</p>
<h3 id="索引结构">索引结构</h3>
<p>BTree索引</p>
<p>b+树</p>
<p>Hash索引</p>
<p>full-text全文索引</p>
<p>R-Tree索引</p>
<h3 id="哪些情况需要创建索引">哪些情况需要创建索引？</h3>
<ol>
<li>主键自动创建索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其他表关联的字段，外键关系建立索引</li>
<li>频繁更新的字段不适合创建索引，因为每次更新不单单是更新了记录还会更新索引</li>
<li>where条件里用不到的字段不创建索引</li>
<li>单键/组合索引的选择问题（在高并发下倾向创建组合索引）</li>
<li>查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度</li>
<li>查询中统计或者分组的字段</li>
</ol>
<h3 id="哪些情况不需要创建索引">哪些情况不需要创建索引？</h3>
<ol>
<li>
<p>表记录太少</p>
</li>
<li>
<p>经常增删改的表</p>
<blockquote>
<p>提高了查询速度，同时会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。</p>
<p>因为在更新表时，MYSQL不仅要保存数据，还要保存一些索引文件。</p>
</blockquote>
</li>
<li>
<p>数据重复且分布均匀的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。</p>
<p>如果某个数据列包含许多重复内容，为它建立索引就没有太大的实际效果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595923227254.png" alt="1595923227254"></p>
</li>
</ol>
<h3 id="性能分析查询执行计划">性能分析（查询执行计划）</h3>
<p>MYSQL QUERY Optimizer</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595923535216.png" alt="1595923535216"></p>
<p>MYSQL的常见瓶颈</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595923570837.png" alt="1595923570837"></p>
<h4 id="explain">Explain</h4>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595923735876.png" alt="1595923735876"></p>
<p>能干吗</p>
<ul>
<li>表的读取顺序</li>
<li>数据读取操作的操作类型</li>
<li>哪些索引可以使用</li>
<li>那些索引被实际使用</li>
<li>表之间的引用</li>
<li>每张表有多少行被优化器查询</li>
</ul>
<h5 id="使用explain--sql语句">使用：Explain + SQL语句</h5>
<p>执行计划包含的信息</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595927315197.png" alt="1595927315197"></p>
<h4 id="表的读取顺序">表的读取顺序</h4>
<h5 id="id">id：</h5>
<blockquote>
<p>select查询的序列号,包含一组数字,表示查询中执行select子句或操作表的顺序</p>
<p>三种情况:</p>
<ul>
<li>
<p>id相同,执行顺序由上至下</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595927536666.png" alt=" "></p>
</li>
<li>
<p>id不同,如果是子查询,id的序号会递增,id值越大优先级会越高,越先被执行.</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595928872305.png" alt="1595928872305"></p>
</li>
<li>
<p>id相同不同,同时存在</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595929240606.png" alt="1595929240606"></p>
<p>derive的2指的是id为2的t3.</p>
</li>
</ul>
</blockquote>
<h4 id="数据读取操作的操作类型">数据读取操作的操作类型</h4>
<h5 id="select_type">select_type：</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595987567416.png" alt="1595987567416"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1595987675026.png" alt="1595987675026"></p>
<h5 id="table">table：</h5>
<p>显示这一行数据是关于哪张表的</p>
<h5 id="type">type：</h5>
<p>访问类型</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596002301273.png" alt="1596002301273"></p>
<p>显示查询使用了何种类型，</p>
<p>从最好到最差依次是：</p>
<p>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt;ALL</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596002552181.png" alt="1596002552181"></p>
<ul>
<li>
<p>system</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596002626747.png" alt="1596002626747"></p>
</li>
<li>
<p>const</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596002709087.png" alt="1596002709087"></p>
</li>
<li>
<p>eq_ref</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596002859369.png" alt="1596002859369"></p>
</li>
<li>
<p>ref</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596003234330.png" alt="1596003234330"></p>
</li>
<li>
<p>range</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006294816.png" alt="1596006294816"></p>
</li>
<li>
<p>index</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006410428.png" alt="1596006410428"></p>
</li>
<li>
<p>ALL</p>
<p>全表扫描</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006425805.png" alt="1596006425805"></p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006455254.png" alt="1596006455254"></p>
<h5 id="possible_keys-和-key">possible_keys 和 key：</h5>
<p>possible_keys：</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006649311.png" alt="1596006649311"></p>
<p>key：</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596006751196.png" alt="1596006751196"></p>
<h5 id="key_len">key_len:</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596007145091.png" alt="1596007145091"></p>
<p>4(char长度)*3(UTF-8）+1（null）=13</p>
<h5 id="ref">ref:</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596007454015.png" alt="1596007454015"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596008615453.png" alt="1596008615453"></p>
<h5 id="rows">rows:</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596008758503.png" alt="1596008758503"></p>
<h5 id="extra">extra:</h5>
<p>包含不适合在其他列中显示但十分重要的额外信息</p>
<blockquote>
<p><strong>Using filesort</strong></p>
<p>说明mysql会对数据使用一个外部的索引排序,而不是按照表内的索引顺序进行读取,MYSQL中无法利用索引完成的排序操作被称为&quot;文件排序&quot;</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596010221763.png" alt="1596010221763"></p>
<p><strong>Using temporary</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596010368374.png" alt="1596010368374"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596010573507.png" alt="1596010573507"></p>
<p><strong>Using index</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596011670611.png" alt="1596011670611"></p>
<p>覆盖索引,在possible_keys没有出现但在key出现</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596011879046.png" alt="1596011879046"></p>
<p>覆盖索引:<img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596011985825.png" alt="1596011985825"></p>
<p><strong>Using where</strong></p>
<p>使用了where过滤</p>
<p><strong>using join buffer</strong></p>
<p>使用了连接缓存</p>
<p><strong>impossiable where</strong></p>
<p>where子句的值总是false,不能用来获取任何元组</p>
<p><strong>select tables optimized away</strong></p>
<p>在没有GROUPBY子句的情况下,基于索引优化MIN/MAX操作或者对于MyISAM存储引擎优化COUNT(*)操作不必等到执行阶段再进行计算,查询执行计划生成的阶段即完成优化.</p>
<p><strong>distinct</strong></p>
<p>优化distinct操作，在找到第一匹配的元组后即停止找同样值的动作。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596012711619.png" alt="1596012711619"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596012728741.png" alt="1596012728741"></p>
<h3 id="单表优化">单表优化</h3>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596025975416.png" alt="1596025975416"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596025918356.png" alt="1596025918356"></p>
<p>范围使索引失效</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596026094589.png" alt="1596026094589"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596026161365.png" alt="1596026161365"></p>
<h3 id="两表优化">两表优化</h3>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596034217829.png" alt="1596034217829"></p>
<p>先尝试只添加右表的索引</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596034306983.png" alt="1596034306983"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596034355686.png" alt="1596034355686"></p>
<p>左表</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596034657083.png" alt="1596034657083"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596034707674.png" alt="1596034707674"></p>
<h4 id="所以左连接要加右表左表全有加不加索引都是全表查询">所以左连接要加右表。左表全有，加不加索引都是全表查询。</h4>
<h3 id="三表优化">三表优化</h3>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596035555366.png" alt="1596035555366"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596035651547.png" alt="1596035651547"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596035870103.png" alt="1596035870103"></p>
<h2 id="索引优化">索引优化</h2>
<h3 id="避免索引失效">避免索引失效</h3>
<p>建表</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596090287752.png" alt="1596090287752"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596090383772.png" alt="1596090383772"></p>
<ol>
<li>
<p>全值匹配</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596090596937.png" alt="1596090596937"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596090698031.png" alt="1596090698031"></p>
<p>第一层索引没用上，梯子断裂，<strong>最佳左前缀原则</strong></p>
</li>
<li>
<h4 id="最佳左前缀原则"><strong>最佳左前缀原则</strong></h4>
<blockquote>
<p>如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始并且不跳过索引中的列。</p>
</blockquote>
</li>
<li>
<p>不在索引列上做任何操作<img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596091591987.png" alt="1596091591987"></p>
</li>
<li>
<p>存储引擎不能使用索引中范围条件右边的列</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596091809527.png" alt="1596091809527"></p>
<p>范围后面的索引失效</p>
</li>
<li>
<p>尽量使用覆盖索引</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596092067130.png" alt="1596092067130"></p>
</li>
<li>
<p>使用不等于（!=或者&lt;&gt;）的时候无法使用索引会导致全表扫描</p>
</li>
<li>
<p>is not,is not null无法使用索引</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596092443607.png" alt="1596092443607"></p>
</li>
<li>
<p>like以通配符开头使索引失效会变成全表扫描</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596092593809.png" alt="1596092593809"></p>
<p>要使用两边都带有通配符 ' %XX% ' 的解决方法:</p>
<p>创建覆盖索引;</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596093309432.png" alt="1596093309432"></p>
</li>
<li>
<p>字符串不加单引号索引失效</p>
</li>
<li>
<p>少用or,用它来连接时索引失效</p>
</li>
</ol>
<p>other:</p>
<p>范围后索引断开,使用范围的字段也部分使用了索引.</p>
<p>用于字段排序的索引一定要按照建立索引的字段顺序.否则会产生filesort.</p>
<p>排序也会使用索引并且不会断开,但不显示在ref字段上.</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596096019383.png" alt="1596096019383"></p>
<p>分组之前必排序,会有临时表产生</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596096420658.png" alt="1596096420658"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596098552860.png" alt="1596098552860"></p>
<h3 id="查询截取分析">查询截取分析</h3>
<h4 id="查询优化">查询优化</h4>
<ol>
<li>
<p>小表驱动大表</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596113933906.png" alt="1596113933906"></p>
<p>&ldquo;select 1 from&quot;的1是什么都行,是个常量就行</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596114222051.png" alt="1596114222051"></p>
<p>in 和 exists</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596114728723.png" alt="1596114728723"></p>
</li>
</ol>
<h3 id="order-by关键字排序优化">Order by关键字排序优化</h3>
<ol>
<li>
<p><strong>order by子句，尽量使用index方式排序，避免使用filesort方式排序；</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596180644843.png" alt="1596180644843"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596180875682.png" alt="1596180875682"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596180941151.png" alt="1596180941151"></p>
<p>默认是升序。要不就全部升序,要不就全部降序</p>
</li>
<li>
<p><strong>尽可能在索引树上完成排序操作，遵照索引建的最佳最前缀</strong></p>
</li>
<li>
<p><strong>如果不在索引列上，filesort有两种算法:</strong></p>
<p><strong>mysql就要启动双路排序和单路排序；</strong></p>
<blockquote>
<p>双路排序：MYSQL4.1之前是使用双路排序，字面意思就是两次扫描磁盘，最终得到数据，读取行指针和orderby列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出。</p>
<p>从磁盘取排序字段，在buffer进行排序，再从磁盘取其他字段。</p>
<p>取一批数据，要从磁盘进行了两次扫描，众所周知，I\O是很耗时的，所以在mysql4.1之后，出现了第二种改进的算法，就是单路排序。</p>
<p>单路排序：从磁盘读取查询需要的所有列，按照order by列在buffer对它们进行排序，然后扫描排序后的列表进行输出，它的效率更快一些，避免了第二次读取数据。并且把随机IO变成了顺序IO，但是它会使用更多的空间。因为它把每一行都保存在内存了。</p>
<p>单路是后出的，总体而言好过双路。</p>
<p>单路也有问题：<img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596184232403.png" alt="1596184232403"></p>
</blockquote>
</li>
<li>
<p><strong>优化策略</strong></p>
<blockquote>
<p>增大sort_buffer_size参数的设置</p>
<p>增大max_length_for_sort_data参数的设置</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596184507560.png" alt="1596184507560"></p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596184598926.png" alt="1596184598926"></p>
<h5 id="总结">总结:</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596184599055.png" alt="1596184599055"></p>
<h3 id="group-by关键字优化">group by关键字优化</h3>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596184960579.png" alt="1596184960579"></p>
<h2 id="慢查询日志">慢查询日志</h2>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596185094308.png" alt="1596185094308"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596188504073.png" alt="1596188504073"></p>
<p>查看是否开启</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%slow_query_log%&#39;</span>;
</code></pre></div><p>默认是关闭的</p>
<p>开启</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> global slow_query_log<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596188752818.png" alt="1596188752818"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596189293802.png" alt="1596189293802"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596189329303.png" alt="1596189329303"></p>
<p>开启了慢查询日志后,什么样的SQL才会记录到慢查询日志里面呢?</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596189519955.png" alt="1596189519955"></p>
<p>设置慢的阈值时间:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> global long_query_time<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>;
<span style="color:#75715e">##需要重新连接或新开一个会话才能看到修改值.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;long_query_time%&#39;</span>;

<span style="color:#75715e">##或者使用
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> global VARIABLES <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;long_query_time&#39;</span>;
</code></pre></div><p>模拟</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">sleep</span>(<span style="color:#ae81ff">4</span>);
</code></pre></div><p>查看日志</p>
<pre><code>cat /var/lib/mysql/***.log
</code></pre><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596190235561.png" alt="1596190235561"></p>
<p>查询当前系统中有多少条慢查询记录</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596196732744.png" alt="1596196732744"></p>
<p>配置文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596196765703.png" alt="1596196765703"></p>
<h5 id="日志分析工具">日志分析工具</h5>
<p>在生产环境中,如果要手工分析日志,查找、分析SQL,显然是个体力活,MYSQL提供了日志分析工具mysqldumpslow.</p>
<p>使用帮助</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysqldumpslow <span style="color:#f92672">--</span>help
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596197041821.png" alt="1596197041821"></p>
<p>常用参考:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596197129161.png" alt="1596197129161"></p>
<h2 id="批量插入数据脚本">批量插入数据脚本</h2>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596197341176.png" alt="1596197341176"></p>
<ol>
<li>
<p>建数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> bigData;
<span style="color:#66d9ef">use</span> bigData;
</code></pre></div></li>
<li>
<p>建表dept</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> dept(
 id INT UNSIGNED <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
    <span style="color:#f92672">##</span><span style="color:#960050;background-color:#1e0010">部门编号</span>
    deptno MEDIUMINT UNSIGNED <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">##</span><span style="color:#960050;background-color:#1e0010">部门名称</span>
    dname VARCHAR(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">##</span><span style="color:#960050;background-color:#1e0010">楼层</span>
    loc VARCHAR(<span style="color:#ae81ff">13</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#34;&#34;</span>
)ENGINE <span style="color:#f92672">=</span> INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>GBK;
</code></pre></div><p>建表emp</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596197755173.png" alt="1596197755173"></p>
</li>
<li>
<p>设置参数log_bin_trust_function_creators</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596197943115.png" alt="1596197943115"></p>
</li>
<li>
<p>随机产生部门字符串</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596203524363.png" alt="1596203524363"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596203855006.png" alt="1596203855006"></p>
</li>
<li>
<p>创建存储过程</p>
<h5 id="创建往emp表插入数据的存储过程">创建往emp表插入数据的存储过程</h5>
<p><strong>function:有返回值</strong></p>
<p><strong>procedure:无返回值</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596204083288.png" alt="1596204083288"></p>
<h5 id="创建往dept表插入数据的存储过程">创建往dept表插入数据的存储过程</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596204389262.png" alt="1596204389262"></p>
</li>
<li>
<p>调用存储过程</p>
<p>dept</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596204532873.png" alt="1596204532873"></p>
<p>emp</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596205863651.png" alt="1596205863651"></p>
</li>
</ol>
<h2 id="show-profile">Show Profile</h2>
<blockquote>
<p>是mysql提供可以用来分析当前会话中语句执行的资源消耗情况.可以用于SQl的调优的测量.</p>
</blockquote>
<p>默认情况下,参数处于关闭状态,并保存最近15次的运行结果.</p>
<p>看看当前的mysql版本是否支持</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">Show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;profiling&#39;</span>;  
<span style="color:#960050;background-color:#1e0010">或者</span>Show variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;profiling%&#39;</span>;
<span style="color:#75715e">##默认是关闭的,使用前需要开启
</span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596277672469.png" alt="1596277672469"></p>
<p>开启功能</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596277717456.png" alt="1596277717456"></p>
<p>运行SQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> id<span style="color:#f92672">%</span><span style="color:#ae81ff">10</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">150000</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> id<span style="color:#f92672">%</span><span style="color:#ae81ff">20</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#ae81ff">5</span>;
</code></pre></div><p>查看结果</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">show</span> profiles;
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596278164535.png" alt="1596278164535"></p>
<p>诊断SQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">show</span> profile cpu, block io <span style="color:#66d9ef">for</span> query <span style="color:#a6e22e">ID</span>(<span style="color:#960050;background-color:#1e0010">上一步前面的问题</span>SQL数字号码); 
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596281249332.png" alt="1596281249332"></p>
<p>需要注意的:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596281293913.png" alt="1596281293913"></p>
<h2 id="全局查询日志">全局查询日志</h2>
<h5 id="永远不要在生产环境开启这个功能仅在测试环境使用">永远不要在生产环境开启这个功能,仅在测试环境使用.</h5>
<p>配置开启:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596283157110.png" alt="1596283157110"></p>
<p>编码开启:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596283183562.png" alt="1596283183562"></p>
<h2 id="数据库锁">数据库锁</h2>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制.在数据库中,除传统的计算资源(如CPU,RAM,I/O等)的争用以外,数据也是供许多用户共享的资源.如何保证数据并发访问的一致性、有效性hi所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
<h3 id="锁的分类">锁的分类</h3>
<p>从对数据操作的类型(读\写)分</p>
<blockquote>
<p>读锁(共享锁): 针对同一份数据,多个读操作可以同时进行而不会互相影响</p>
<p>写锁(排他锁): 当前写操作没有完成前,它会阻断其他写锁和读锁;</p>
</blockquote>
<p>从对数据操作的粒度分</p>
<blockquote>
<p>表锁</p>
<p>行锁</p>
</blockquote>
<h3 id="mysql锁机制">MYSQL锁机制</h3>
<h5 id="三锁-">三锁 ↓</h5>
<h3 id="表锁偏读">表锁(偏读)</h3>
<p>特点:偏向MyISAM存储引擎,开销小,加锁快;无死锁;锁定粒度大,发生锁冲突的概率最高,并发度最低</p>
<p>案例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596287138753.png" alt="1596287138753"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596287239538.png" alt="1596287239538"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596287470060.png" alt="1596287470060"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596287910808.png" alt="1596287910808"></p>
<p>读操作时共享的,会话1和2都可以读mylock;</p>
<p>会话1不能更新表;</p>
<p>会话1只能读加读锁的mylock表,不能读其他表(book);会话2可以读其他表.</p>
<p>会话2如果要更新表,会形成阻塞,要<strong>等待锁的释放</strong>(unlock tables)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596288189317.png" alt="1596288189317"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596288256700.png" alt="1596288256700"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596288286059.png" alt="1596288286059"></p>
<h5 id="写锁">写锁</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596293163830.png" alt="1596293163830"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596293452648.png" alt="1596293452648"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596293310415.png" alt="1596293310415"></p>
<p>其他会话读被锁的表会阻塞;</p>
<p>结论:<img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596293501087.png" alt="1596293501087"></p>
<p>简而言之,就是读锁会阻塞写,但是不会堵塞读,而写锁则会把读和写都堵塞.</p>
<h5 id="看看哪些表被锁了">看看哪些表被锁了</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">show</span> open <span style="color:#66d9ef">tables</span>;
</code></pre></div><h5 id="如何分析表锁定">如何分析表锁定</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596294625538.png" alt="1596294625538"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596294765205.png" alt="1596294765205"></p>
<h3 id="行锁偏写">行锁(偏写)</h3>
<p><strong>特点</strong>：偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。</p>
<p>InnoDB与MyISAM的最大不同也有两点：</p>
<p>一是支持事务(TRANSACTION);</p>
<p>二是采用了行级锁.</p>
<h5 id="事务transaction及其acid属性">事务(Transaction)及其ACID属性</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596361613254.png" alt="1596361613254"></p>
<h5 id="并发处理事务带来的问题">并发处理事务带来的问题</h5>
<blockquote>
<p>更新丢失(Lost Update)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596361800362.png" alt="1596361800362"></p>
<p>脏读(Dirty Reads)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596361853689.png" alt="1596361853689"></p>
<p>不可重复读(Non-Repeatable Reads)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596361887110.png" alt="1596361887110"></p>
<p>幻读(Planttom Reads)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596361949063.png" alt="1596361949063"></p>
</blockquote>
<h5 id="事务隔离级别">事务隔离级别;</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596362019625.png" alt="1596362019625"></p>
<p>默认级别是Repeatable read</p>
<h4 id="案例分析">案例分析:</h4>
<p>建表</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596362218502.png" alt="1596362218502"></p>
<p>select * from test_innodb_lock;</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596362340762.png" alt="1596362340762"></p>
<p>在没session1和2提交commit之前,session-2读不到修改的数据.</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596362749535.png" alt="1596362749535"></p>
<p>操作不同行,不会阻塞</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596363091362.png" alt="1596363091362"></p>
<h5 id="无索引行锁变表锁">无索引行锁变表锁;</h5>
<p>类型转换,索引失效:  (b=&lsquo;4000&rsquo;)</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596364172827.png" alt="1596364172827"></p>
<p>行锁变表锁,造成阻塞.</p>
<h5 id="间隙锁的危害">间隙锁的危害</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596367264611.png" alt="1596367264611"></p>
<p>session2会阻塞,</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596367511520.png" alt="1596367511520"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596367327059.png" alt="1596367327059"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596367354502.png" alt="1596367354502"></p>
<h5 id="如何锁定一行">如何锁定一行</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596367801141.png" alt="1596367801141"></p>
<p>行锁总结</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596368151351.png" alt="1596368151351"></p>
<h5 id="如何分析行锁定">如何分析行锁定</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596368219445.png" alt="1596368219445"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596368336057.png" alt="1596368336057"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596368378801.png" alt="1596368378801"></p>
<p>优化建议:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596368467316.png" alt="1596368467316"></p>
<h3 id="页锁">页锁</h3>
<p>开销和加锁时间界于表锁和行锁之间,会出现死锁;锁定粒度界于表锁和行锁之间,并发度一般.</p>
<h2 id="主从复制">主从复制</h2>
<h4 id="复制的基本原理">复制的基本原理：</h4>
<blockquote>
<p>slave会从master读取binlog来进行数据同步</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596372268011.png" alt="1596372268011"></p>
<h4 id="复制的基本原则">复制的基本原则：</h4>
<blockquote>
<p>每个slave只有一个master</p>
<p>每个slave只能有一个唯一的服务器ID</p>
<p>每个master可以有多个slave</p>
</blockquote>
<h4 id="复制的最大问题">复制的最大问题：</h4>
<p>延时</p>
<h4 id="一主一从常见配置">一主一从常见配置：</h4>
<blockquote>
<p>mysql版本要一致且后台以服务运行. 网段要相通ping</p>
<p>主从都配置在[mysqld]结点下,都是小写.</p>
<p>主机(window)修改my.ini配置文件</p>
<ul>
<li>
<p>主服务器唯一ID[<code>必须</code>]</p>
<ul>
<li>server-id = 1</li>
</ul>
</li>
<li>
<p>启动二进制日志[<code>必须</code>]</p>
<p>log-bin=自己本地的路径/mysqlbin</p>
<p>log-bin=D:/devSoft/MySQLServer5.5/data/mysqlbin</p>
</li>
<li>
<p>启用错误日志[<code>可选</code>]</p>
<p>log-err = 自己本地的路径/mysqlerr</p>
<p>log-err = D:/devSoft/MySQLServer5.5/data/mysqlerr</p>
</li>
<li>
<p>根目录[<code>可选</code>]</p>
<p>basedir = &ldquo;自己本地路径&rdquo;</p>
<p>basedir = &ldquo;D:/devSoft/MySQLServer5.5/&rdquo;</p>
</li>
<li>
<p>临时目录[<code>可选</code>]</p>
<p>tmpdir = &ldquo;自己本地路径&rdquo;</p>
<p>tmpdir = &ldquo;D:/devSoft/MySQLServer5.5/&rdquo;</p>
</li>
<li>
<p>数据目录[<code>可选</code>]</p>
<p>datadir = &ldquo;自己本地路径/Data/&rdquo;</p>
<p>datadir = &ldquo;D:/devSoft/MySQLServer5.5/Data/&rdquo;</p>
</li>
<li>
<p>read-only=0</p>
<p>主机, 读写都可以</p>
</li>
<li>
<p>设置不要复制的数据库[<code>可选</code>]</p>
<p>binlog-ignore-db=mysql</p>
</li>
<li>
<p>设置需要复制的数据库[<code>可选</code>]</p>
<p>binlog-do-db=需要复制的主数据库名字</p>
</li>
</ul>
<p>从机(Linux)修改my.cnf配置文件</p>
<p>从服务器唯一ID[<code>必须</code>]</p>
<p>注释 server-id=1</p>
<p>下翻,取消注释server-id = 2</p>
<p>启动二进制日志[<code>可选</code>]</p>
<p>因修改过配置文件,请主机+从机都重启后台mysql服务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">service mysql stop
service mysql start
ps <span style="color:#f92672">-</span>ef<span style="color:#f92672">|</span>grep mysql
</code></pre></div><p>主机从机都关闭防火墙</p>
<pre><code>window 手动关闭
linux从机  service iptables stop
</code></pre><p>在window主机上建立账户并授权slave</p>
<p>mysql</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596381866992.png" alt="1596381866992"></p>
<pre><code>flush privileges
</code></pre><p>查看master的状态</p>
<pre><code>show master status;
</code></pre><p>记录下File和Position的值.</p>
<p><strong>Position</strong>在后面使用后会有变化</p>
<p>在linux从机上配置需要复制的主机</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596382399568.png" alt="1596382399568"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/MYSQL/1596382484275.png" alt="1596382484275"></p>
<p>启动从服务器复制功能</p>
<pre><code>start slave;
</code></pre><pre><code>show slave status\G
下面两个参数都是Yes,则说明主从配置成功.
Slave_IO_Running:Yes
Slave_SQL_Running:Yes
</code></pre><p>主机建库,建表</p>
<p>insert记录</p>
<p>从机有记录</p>
<p>停止从机复制功能</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">stop slave;
</code></pre></div></blockquote>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Kayleh </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://kayleh.top/mysql/>https://kayleh.top/mysql/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://kayleh.top/tags/sql/">
                    #sql</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://kayleh.top">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://kayleh.top/http/" class="prev" rel="prev" title="HTTP"><i class="iconfont icon-left"></i>&nbsp;HTTP</a>
         
        
        <a href="https://kayleh.top/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%841/" class="next" rel="next" title="SpringCloud">SpringCloud&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <script async="" src="https://widget.daovoice.io/widget/38b1c911.js" charset="utf-8"></script>
    <script data-ad-client="ca-pub-7457165067653912" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      daovoice('init', {
        app_id: "38b1c911"
      });
      daovoice('update');
      </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle"style="display:inline-block;width:728px;height:90px"data-ad-client="ca-pub-7457165067653912"data-ad-slot="9837525717"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?2cd1dc193190f18fed292accb735c684";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://kayleh.top">Kayleh</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
