<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Kayleh">
  
  
  
  <link rel="prev" href="https://kayleh.top/improve-robustness-1/" />
  <link rel="next" href="https://kayleh.top/note/" />
  <link rel="canonical" href="https://kayleh.top/springsecurity/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  
  <meta name="google-site-verification" content="LQn0xwjfEU_V6CXCA0qAdwM4qRXtblIbfy5KuzEKaRg" />
  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?24f5d46da7ff42ae73ccea4ea7114e1b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>    
  
  <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/9e961453.js","daovoice")</script>
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           SpringSecurity | Kayleh
       
  </title>
  <meta name="title" content="SpringSecurity | Kayleh">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/kayleh.top"
    },
    "articleSection" : "posts",
    "name" : "SpringSecurity",
    "headline" : "SpringSecurity",
    "description" : "SpringBootæ•´åˆSpringSecurity  https:\/\/www.kuangstudy.com\/bbs\/1369251751735095298\n Spring Securityè¯¾ç¨‹ä»‹ç» 1. æ¡†æ¶æ¦‚è¿° ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´ï¼ŒWebåº”ç”¨çš„å®‰å…¨æ€§ä¸»è¦åŒ…æ‹¬ç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒä¸¤ä¸ªéƒ¨åˆ†,è¿™ä¸¤ç‚¹ä¹Ÿæ˜¯Spring Securityçš„é‡è¦æ ¸å¿ƒåŠŸèƒ½ã€‚\n ç”¨æˆ·è®¤è¯æŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿä¸­çš„åˆæ³•ä¸»ä½“,ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·èƒ½å¦è®¿é—®è¯¥ç³»ç»Ÿã€‚ç”¨æˆ·è®¤è¯ä¸€èˆ¬è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç³»ç»Ÿé€šè¿‡æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ã€‚==é€šä¿—ç‚¹è¯´å°±æ˜¯ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ˜¯å¦èƒ½ç™»å½•ã€‚== ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚åœ¨åŒä¸€ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæœ‰çš„ç”¨æˆ·åªèƒ½è¿›è¡Œè¯»å–ï¼Œè€Œæœ‰çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¼šä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²å¯¹åº”ä¸€ç³»åˆ—çš„æƒé™ã€‚==é€šä¿—ç‚¹å°±æ˜¯ç³»ç»Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å»åšæŸäº›äº‹æƒ…ã€‚==  ğŸ“• Spring Security ç‰¹ç‚¹ :\n å’ŒSpringæ— ç¼æ•´åˆã€‚ å…¨é¢çš„æƒé™æ§åˆ¶ ä¸“é—¨ä¸ºWebå¼€å‘è€Œè®¾è®¡  æ—§ç‰ˆæœ¬ä¸èƒ½è„±ç¦»Webç¯å¢ƒä½¿ç”¨ æ–°ç‰ˆæœ¬å¯¹æ•´ä¸ªæ¡†æ¶è¿›è¡Œäº†åˆ†å±‚æŠ½å–ï¼Œåˆ†æˆäº†æ ¸å¿ƒæ¨¡å—å’ŒWebæ¨¡å—,å•ç‹¬å¼•å…¥æ ¸å¿ƒæ¨¡å—å°±å¯ä»¥è„±ç¦»Webç¯å¢ƒã€‚   é‡é‡çº§ã€‚  2. å…¥é—¨æ¡ˆä¾‹   åˆ›å»ºSpringBootå·¥ç¨‹,å¼•å…¥ç›¸å…³ä¾èµ–\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.1.RELEASE\u0026lt;\/version\u0026gt; \u0026lt;relativePath\/\u0026gt; \u0026lt;\/parent\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--Web ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;\/artifactId\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;!--Spring Securityçš„ç›¸å…³ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;\/artifactId\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;\/dependencies\u0026gt;   ç¼–å†™Controllerè¿›è¡Œæµ‹è¯•\n@RestController public class TestController { @GetMapping(\u0026#34;\/add\u0026#34;) public String add() { return \u0026#34;hello Security\u0026#34;; } }   3.",
    "inLanguage" : "en-us",
    "author" : "Kayleh",
    "creator" : "Kayleh",
    "publisher": "Kayleh",
    "accountablePerson" : "Kayleh",
    "copyrightHolder" : "Kayleh",
    "copyrightYear" : "2021",
    "datePublished": "2021-05-21 11:56:08 \u002b0800 CST",
    "dateModified" : "2021-05-21 11:56:08 \u002b0800 CST",
    "url" : "https:\/\/kayleh.top\/springsecurity\/",
    "wordCount" : "645",
    "keywords" : [  "Kayleh"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="https://shell.kayleh.top" title="">Terminal</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="https://shell.kayleh.top" title="">Terminal</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">SpringSecurity</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://kayleh.top" rel="author">Kayleh</a> with â™¥ 
                <span class="post-time">
                on <time datetime=2021-05-21 itemprop="datePublished">May 21, 2021</time>
                </span>.
                Total words:
                645
                ,ReadingTime:
                4 minutes
                
                
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <h1 id="springbootæ•´åˆspringsecurity">SpringBootæ•´åˆSpringSecurity</h1>
<blockquote>
<p><a href="https://www.kuangstudy.com/bbs/1369251751735095298">https://www.kuangstudy.com/bbs/1369251751735095298</a></p>
</blockquote>
<h2 id="spring-securityè¯¾ç¨‹ä»‹ç»">Spring Securityè¯¾ç¨‹ä»‹ç»</h2>
<h3 id="1-æ¡†æ¶æ¦‚è¿°">1. æ¡†æ¶æ¦‚è¿°</h3>
<p>ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´ï¼ŒWebåº”ç”¨çš„å®‰å…¨æ€§ä¸»è¦åŒ…æ‹¬ç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒä¸¤ä¸ªéƒ¨åˆ†,è¿™ä¸¤ç‚¹ä¹Ÿæ˜¯Spring Securityçš„é‡è¦æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<ol>
<li>ç”¨æˆ·è®¤è¯æŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿä¸­çš„åˆæ³•ä¸»ä½“,ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·èƒ½å¦è®¿é—®è¯¥ç³»ç»Ÿã€‚ç”¨æˆ·è®¤è¯ä¸€èˆ¬è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç³»ç»Ÿé€šè¿‡æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ã€‚<strong>==é€šä¿—ç‚¹è¯´å°±æ˜¯ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ˜¯å¦èƒ½ç™»å½•ã€‚==</strong></li>
<li>ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚åœ¨åŒä¸€ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæœ‰çš„ç”¨æˆ·åªèƒ½è¿›è¡Œè¯»å–ï¼Œè€Œæœ‰çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¼šä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²å¯¹åº”ä¸€ç³»åˆ—çš„æƒé™ã€‚<strong>==é€šä¿—ç‚¹å°±æ˜¯ç³»ç»Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å»åšæŸäº›äº‹æƒ…ã€‚==</strong></li>
</ol>
<p>ğŸ“• Spring Security ç‰¹ç‚¹ :</p>
<ul>
<li>å’ŒSpringæ— ç¼æ•´åˆã€‚</li>
<li>å…¨é¢çš„æƒé™æ§åˆ¶</li>
<li>ä¸“é—¨ä¸ºWebå¼€å‘è€Œè®¾è®¡
<ul>
<li>æ—§ç‰ˆæœ¬ä¸èƒ½è„±ç¦»Webç¯å¢ƒä½¿ç”¨</li>
<li>æ–°ç‰ˆæœ¬å¯¹æ•´ä¸ªæ¡†æ¶è¿›è¡Œäº†åˆ†å±‚æŠ½å–ï¼Œåˆ†æˆäº†æ ¸å¿ƒæ¨¡å—å’ŒWebæ¨¡å—,å•ç‹¬å¼•å…¥æ ¸å¿ƒæ¨¡å—å°±å¯ä»¥è„±ç¦»Webç¯å¢ƒã€‚</li>
</ul>
</li>
<li>é‡é‡çº§ã€‚</li>
</ul>
<h3 id="2-å…¥é—¨æ¡ˆä¾‹">2. å…¥é—¨æ¡ˆä¾‹</h3>
<ol>
<li>
<p>åˆ›å»ºSpringBootå·¥ç¨‹,å¼•å…¥ç›¸å…³ä¾èµ–</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;parent&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.2.1.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;relativePath/&gt;</span>
    <span style="color:#f92672">&lt;/parent&gt;</span>
    <span style="color:#f92672">&lt;dependencies&gt;</span>
        <span style="color:#75715e">&lt;!--Web ä¾èµ–--&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#75715e">&lt;!--Spring Securityçš„ç›¸å…³ä¾èµ–--&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div></li>
<li>
<p>ç¼–å†™Controllerè¿›è¡Œæµ‹è¯•</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestController</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestController</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/add&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">add</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hello Security&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ol>
<h3 id="3-springsecurityåŸºæœ¬åŸç†">3. SpringSecurityåŸºæœ¬åŸç†</h3>
<p>ğŸŒ³ <strong>Spring Security æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾</strong></p>
<ul>
<li>FilterSecurityInterceptor : æ˜¯ä¸€ä¸ªæ–¹æ³•çº§çš„æƒé™è¿‡æ»¤å™¨,åŸºæœ¬ä½äºè¿‡æ»¤é“¾çš„æœ€åº•éƒ¨</li>
<li>ExceptionTranslationFilter : æ˜¯ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤å™¨,ç”¨æ¥å¤„ç†åœ¨è®¤è¯æˆæƒè¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸</li>
<li>UsernamePassowrdAuthenticationFilter : å¯¹/loginçš„postè¯·æ±‚åšæ‹¦æˆª,æ ¡éªŒè¡¨å•ä¸­ç”¨æˆ·åå’Œå¯†ç ã€‚</li>
</ul>
<p>ğŸŒ³ è¿‡æ»¤å™¨æ˜¯å¦‚ä½•è¿›è¡ŒåŠ è½½çš„ï¼Ÿ</p>
<p><img src="D:%5CHugo%5Chugo_0.75.1_Windows-64bit%5Cblog%5Ccontent%5Cposts%5CSpringSecurity%5CrikcLoverikcLoveimage-20210206021008467.png" alt="image-20210206021008467"></p>
<p>ğŸŒ³ ä¸¤ä¸ªé‡è¦çš„æ¥å£</p>
<p>âšª UserDetailsServiceæ¥å£è¯¦è§£</p>
<p>å½“ä»€ä¹ˆä¹Ÿæ²¡æœ‰é…ç½®çš„æ—¶å€™,è´¦å·å’Œå¯†ç æ˜¯ç”±SpringSecurityå®šä¹‰ç”Ÿæˆçš„ã€‚è€Œåœ¨å®é™…é¡¹ç›®ä¸­è´¦å·å’Œå¯†ç éƒ½æ˜¯ä»æ•°æ®åº“ä¸­æŸ¥å‡ºæ¥çš„,æ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è‡ªå®šä¹‰é€»è¾‘æ§åˆ¶è®¤è¯é€»è¾‘ã€‚<strong>==é€šä¿—ç‚¹æ¥è¯´å°±æ˜¯æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç çš„è¿‡ç¨‹==</strong> å¦‚éœ€è¦è‡ªå®šä¹‰é€»è¾‘æ—¶,åªéœ€è¦å®ç°UserDetailsServiceæ¥å£å³å¯ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ :</p>
<p><!-- raw HTML omitted --></p>
<p>è¿”å›å€¼ UserDetails</p>
<p>è¿™ä¸ªç±»æ˜¯ç³»ç»Ÿé»˜è®¤çš„ç”¨æˆ·ä¸»ä½“</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// è¡¨ç¤ºè·å–ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰æƒé™
</span><span style="color:#75715e"></span>Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> GrantedAuthority<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAuthorities</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// è¡¨ç¤ºè·å–å¯†ç 
</span><span style="color:#75715e"></span>String <span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// è¡¨ç¤ºè·å–ç”¨æˆ·å
</span><span style="color:#75715e"></span>String <span style="color:#a6e22e">getUsername</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// è¡¨ç¤ºåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«é”å®š
</span><span style="color:#75715e"></span><span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isAccountNonLocked</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// è¡¨ç¤ºå‡­è¯{å¯†ç }æ˜¯å¦è¿‡æœŸ
</span><span style="color:#75715e"></span><span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isCredentialsNonExpired</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// è¡¨ç¤ºå½“å‰ç”¨æˆ·åæ˜¯å¦å¯ç”¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">();</span>
</code></pre></div><p><img src="D:%5CHugo%5Chugo_0.75.1_Windows-64bit%5Cblog%5Ccontent%5Cposts%5CSpringSecurity%5CrikcLoverikcLoveimage-20210206023136065.png" alt="image-20210206023135919"></p>
<p>âšª PasswordEncoder æ¥å£è®²è§£</p>
<p>æ•°æ®åŠ å¯†çš„æ¥å£,ç”¨äºè¿”å›Userå¯¹è±¡é‡Œé¢å¯†ç åŠ å¯†</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// è¡¨ç¤ºæŠŠå‚æ•°æŒ‰ç…§ç‰¹å®šçš„è§£æè§„åˆ™è¿›è¡Œè§£æ
</span><span style="color:#75715e"></span>String <span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span>CharSequence rawPassword<span style="color:#f92672">);</span>
<span style="color:#75715e">// è¡¨ç¤ºéªŒè¯ä»å­˜å‚¨ä¸­è·å–çš„ç¼–ç å¯†ç ä¸ç¼–ç åæäº¤çš„åŸå§‹å¯†ç æ˜¯å¦åŒ¹é…ã€‚å¦‚æœå¯†ç åŒ¹é…,åˆ™è¿”å›true;å¦‚æœä¸åŒ¹é…,åˆ™è¿”å›falseã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºéœ€è¦è¢«è§£æçš„å¯†ç ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå­˜å‚¨çš„å¯†ç ã€‚
</span><span style="color:#75715e"></span><span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">matches</span><span style="color:#f92672">(</span>CharSequence rawPassowrd<span style="color:#f92672">,</span>String encodePassword<span style="color:#f92672">);</span>
<span style="color:#75715e">// è¡¨ç¤ºå¦‚æœè§£æçš„å¯†ç èƒ½å¤Ÿå†æ¬¡è¿›è¡Œè§£æä¸”è¾¾åˆ°æ›´å®‰å…¨çš„ç»“æœåˆ™è¿”å›true,å¦åˆ™è¿”å›falseã€‚é»˜è®¤è¿”å›false
</span><span style="color:#75715e"></span><span style="color:#66d9ef">default</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">upgradeEncoding</span><span style="color:#f92672">(</span>String encodePassowrd<span style="color:#f92672">);</span>
</code></pre></div><p>âšª BCryptPasswordEncoder</p>
<p>BCryptPasswordEncoderæ˜¯Spring Securityå®˜æ–¹æ¨èçš„å¯†ç è§£æå™¨,å¹³æ—¶å¤šä½¿ç”¨è¿™ä¸ªè§£æå™¨</p>
<p>BCryptPasswordEncoderæ˜¯å¯¹bcryptå¼ºæ•£åˆ—æ–¹æ³•çš„å…·ä½“å®ç°ã€‚æ˜¯åŸºäºHashç®—æ³•å®ç°çš„å•å‘åŠ å¯†ã€‚å¯ä»¥é€šè¿‡strengthæ§åˆ¶åŠ å¯†å¼ºåº¦,é»˜è®¤ä¸º10ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test01</span><span style="color:#f92672">(){</span>
    <span style="color:#75715e">//åˆ›å»ºå¯†ç è§£æå™¨
</span><span style="color:#75715e"></span>    BCryptPasswordEncoder bCryptPasswordEncoder<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> BCryptPasswrodEncoder<span style="color:#f92672">();</span>
    <span style="color:#75715e">//å¯¹å¯†ç è¿›è¡ŒåŠ å¯†
</span><span style="color:#75715e"></span>    String password<span style="color:#f92672">=</span>bCryptPasswordEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//æ‰“å°åŠ å¯†åçš„æ•°æ®
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;åŠ å¯†ä¹‹åçš„æ•°æ®:&#34;</span><span style="color:#f92672">+</span>password<span style="color:#f92672">);</span>
    <span style="color:#75715e">//åˆ¤æ–­åŸå­—ç¬¦åŠ å¯†åå’ŒåŠ å¯†ä¹‹å‰æ˜¯å¦åŒ¹é…
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> result<span style="color:#f92672">=</span>bCryptPasswordEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">matches</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">,</span>password<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="4-ç”¨æˆ·è®¤è¯">4. ç”¨æˆ·è®¤è¯</h3>
<ol>
<li>
<p>è®¾ç½®ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç </p>
<ul>
<li>
<p>ç¬¬ä¸€ç§æ–¹å¼ : é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®</p>
<pre><code class="language-properties" data-lang="properties">spring.security.user.name=rikc
spring.security.user.password=123456
</code></pre></li>
<li>
<p>ç¬¬äºŒç§æ–¹å¼ :é€šè¿‡é…ç½®ç±»</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.wisedu.securitydemo1.config<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.security.crypto.password.PasswordEncoder<span style="color:#f92672">;</span>
     
<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>AuthenticationManagerBuilder auth<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        BCryptPasswordEncoder bCryptPasswordEncoder<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">();</span>
        String password<span style="color:#f92672">=</span>bCryptPasswordEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">);</span>
        auth<span style="color:#f92672">.</span><span style="color:#a6e22e">inMemoryAuthentication</span><span style="color:#f92672">().</span><span style="color:#a6e22e">withUser</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;rikc&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span>password<span style="color:#f92672">).</span><span style="color:#a6e22e">roles</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> PasswordEncoder <span style="color:#a6e22e">password</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>ç¬¬ä¸‰ç§æ–¹å¼ : è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»</p>
<p>Â· ç¬¬ä¸€æ­¥ åˆ›å»ºé…ç½®ç±»,è®¾ç½®ä½¿ç”¨å“ªä¸ªuserDetailsServiceå®ç°ç±»</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig1</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter <span style="color:#f92672">{</span>
  <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">private</span> UserDetailsService userDetailsService<span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>AuthenticationManagerBuilder auth<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        auth<span style="color:#f92672">.</span><span style="color:#a6e22e">userDetailsService</span><span style="color:#f92672">(</span>userDetailsService<span style="color:#f92672">).</span><span style="color:#a6e22e">passwordEncoder</span><span style="color:#f92672">(</span>password<span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> PasswordEncoder <span style="color:#a6e22e">password</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Â· ç¬¬äºŒæ­¥ ç¼–å†™å®ç°ç±»,è¿”å›Userå¯¹è±¡,Userå¯¹è±¡æœ‰ç”¨æˆ·åå¯†ç å’Œæ“ä½œæƒé™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Service</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userDetailsService&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyUserDetailsServie</span> <span style="color:#66d9ef">implements</span> UserDetailsService <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserDetails <span style="color:#a6e22e">loadUserByUsername</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> UsernameNotFoundException <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> auths<span style="color:#f92672">=</span> AuthorityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">commaSeparatedStringToAuthorityList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;role&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;rikc&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">().</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;123&#34;</span><span style="color:#f92672">),</span>auths<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯</p>
<p>è¿™æ˜¯åŸºäº(1)é‡Œé¢çš„ç¬¬ä¸‰ç§è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»é€šè¿‡æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯æ“ä½œ</p>
<p>ğŸ“• å¯¼å…¥ç›¸å…³ä¾èµ–</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.baomidou<span style="color:#f92672">&lt;/groupId&gt;</span>
 <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>3.0.5<span style="color:#f92672">&lt;/version&gt;</span>
</code></pre></div></li>
</ol>
<!-- raw HTML omitted -->
<p>ğŸ“• åˆ¶ä½œå®ä½“ç±»</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String username<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password
<span style="color:#f92672">}</span>
</code></pre></div><p>ğŸ“• æ•´åˆmapper,åˆ›å»ºæ¥å£ï¼Œæ“ä½œæ•°æ®åº“æŸ¥è¯¢</p>
<h3 id="5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢">5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢</h3>
<ol>
<li>
<p>é…ç½®ç±»ä¸­å®ç°ç›¸å…³çš„é…ç½®</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig1</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">private</span> UserDetailsService userDetailsService<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>AuthenticationManagerBuilder auth<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        auth<span style="color:#f92672">.</span><span style="color:#a6e22e">userDetailsService</span><span style="color:#f92672">(</span>userDetailsService<span style="color:#f92672">).</span><span style="color:#a6e22e">passwordEncoder</span><span style="color:#f92672">(</span>password<span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> PasswordEncoder <span style="color:#a6e22e">password</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">    *è‡ªå®šä¹‰ç™»å½•é¡µé¢    
</span><span style="color:#75715e">    */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>HttpSecurity http<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        http<span style="color:#f92672">.</span><span style="color:#a6e22e">formLogin</span><span style="color:#f92672">()</span>    <span style="color:#75715e">//è‡ªå®šä¹‰ç¼–å†™ç™»å½•é¡µé¢
</span><span style="color:#75715e"></span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">loginPage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.html&#34;</span><span style="color:#f92672">)</span>   <span style="color:#75715e">//ç™»å½•é¡µé¢è®¾ç½®
</span><span style="color:#75715e"></span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">loginProcessingUrl</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/user/login&#34;</span><span style="color:#f92672">)</span>     <span style="color:#75715e">//ç™»å½•è®¿é—®Controllerè·¯å¾„
</span><span style="color:#75715e"></span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">defaultSuccessUrl</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test/index&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">permitAll</span><span style="color:#f92672">()</span>   <span style="color:#75715e">//ç™»é™†æˆåŠŸä»¥å,è·³è½¬è·¯å¾„
</span><span style="color:#75715e"></span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">and</span><span style="color:#f92672">().</span><span style="color:#a6e22e">authorizeRequests</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">antMatchers</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/test/hello&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/user/login&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">permitAll</span><span style="color:#f92672">()</span><span style="color:#75715e">//è®¾ç½®å“ªäº›è·¯å¾„å¯ä»¥ç›´æ¥è®¿é—®ä¸éœ€è¦ç™»å½•è®¤è¯
</span><span style="color:#75715e"></span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">anyRequest</span><span style="color:#f92672">().</span><span style="color:#a6e22e">authenticated</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">and</span><span style="color:#f92672">().</span><span style="color:#a6e22e">csrf</span><span style="color:#f92672">().</span><span style="color:#a6e22e">disable</span><span style="color:#f92672">();</span><span style="color:#75715e">//å…³é—­csrfé˜²æŠ¤
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ol>
<h3 id="6-ç”¨æˆ·æˆæƒåŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶">6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)</h3>
<h4 id="61-hasauthority-æ–¹æ³•">6.1 hasAuthority æ–¹æ³•</h4>
<p>å¦‚æœå½“å‰çš„ä¸»ä½“å…·æœ‰æŒ‡å®šçš„æƒé™,åˆ™è¿”å›true,å¦åˆ™è¿”å›false</p>
<ul>
<li>
<p>åœ¨é…ç½®ç±»ä¸­è®¾ç½®å½“å‰è®¿é—®åœ°å€æœ‰å“ªäº›æƒé™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//å½“å‰ç™»å½•ç”¨æˆ·åªæœ‰å…·æœ‰adminsæƒé™æ‰å¯ä»¥è®¿é—®è¿™ä¸ªè·¯å¾„
</span><span style="color:#75715e"></span><span style="color:#f92672">.</span><span style="color:#a6e22e">antMatchers</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test/index&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">hasAuthority</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
<li>
<p>åœ¨UserDetailsService,æŠŠè¿”å›çš„Userå¯¹è±¡è®¾ç½®æƒé™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Users users<span style="color:#f92672">=</span>userMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">selectOne</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//è®¾ç½®ç”¨æˆ·æƒé™ä¸ºç®¡ç†å‘˜æƒé™
</span><span style="color:#75715e"></span>List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> auths<span style="color:#f92672">=</span>AuthorityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">commaSeparatedStringToAuthorityList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">);</span>
UserDetailsSerivce userDetail<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span>users<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserName</span><span style="color:#f92672">,</span><span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">().</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span>users<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">()),</span>auths<span style="color:#f92672">);</span>
</code></pre></div></li>
</ul>
<h4 id="62-hasanyauthority-æ–¹æ³•">6.2 hasAnyAuthority æ–¹æ³•</h4>
<p>å¦‚æœå½“å‰çš„ä¸»ä½“æœ‰ä»»ä½•æä¾›çš„è§’è‰²(ç»™å®šçš„ä½œä¸ºä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨)çš„è¯,è¿”å›true</p>
<pre><code>.anyMatchers(&quot;/test/index&quot;).hasAnyAuthority(&quot;admin,manager&quot;)
</code></pre><h4 id="63-hasrole-æ–¹æ³•">6.3 hasRole æ–¹æ³•</h4>
<p>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²å°±å…è®¸è®¿é—®,å¦åˆ™å‡ºç°403</p>
<p>å¦‚æœå½“å‰ä¸»ä½“å…·æœ‰æŒ‡å®šçš„è§’è‰²,åˆ™è¿”å›true</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">.</span><span style="color:#a6e22e">antMatchers</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test/index&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">hasRole</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;role&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">//æºç ä¸­è¿›è¡Œäº†å°è£…, éœ€è¦æ·»åŠ ROLE_ã€‚
</span><span style="color:#75715e">//æºç     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hasRole(&#39;ROLE_&#34;</span><span style="color:#f92672">+</span>role<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&#39;)&#34;</span><span style="color:#f92672">;</span>
List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> auths<span style="color:#f92672">=</span>AuthorityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">commaSeparatedStringToAuthorityList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin,ROLE_role&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><p>æ³¨æ„ : é…ç½®æ–‡ä»¶ä¸­ä¸éœ€è¦æ·»åŠ â€ROLE_â€,å› ä¸ºä¸Šè¿°çš„åº•å±‚æºç ä¼šè‡ªåŠ¨æ·»åŠ ä¸ä¹‹è¿›è¡ŒåŒ¹é…ã€‚</p>
<h4 id="64-hasanyrole-æ–¹æ³•">6.4 hasAnyRole æ–¹æ³•</h4>
<p>è¡¨ç¤ºç”¨æˆ·å…·å¤‡ä»»ä½•ä¸€ä¸ªæ¡ä»¶éƒ½å¯ä»¥è®¿é—®ã€‚</p>
<p>ç»™ç”¨æˆ·æ·»åŠ è§’è‰²:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//ç”¨æˆ·å¯¹è±¡ä¸ä¸ºç©ºè¿”å›å½“å‰ç”¨æˆ·
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span>username<span style="color:#f92672">,</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">(),</span>AuthorityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">commaSeparatedStringToAuthorityList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin,role,ROLE_admin,ROLE_role&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ :</p>
<pre><code>.antMatchers(&quot;/test/admin&quot;).hasAnyRole(&quot;role&quot;)
</code></pre><h3 id="7-ç”¨æˆ·æˆæƒè‡ªå®šä¹‰403é¡µé¢">7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)</h3>
<p>åœ¨é…ç½®ç±»é‡Œé¢è¿›è¡Œé…ç½®å³å¯ã€‚</p>
<pre><code>http.execptionHandling().accessDeniedPage(&quot;/unauth&quot;);
</code></pre><h3 id="8-ç”¨æˆ·æˆæƒæ³¨è§£ä½¿ç”¨">8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)</h3>
<h4 id="81-securedhttpsgithubcomsecured">8.1 <a href="https://github.com/Secured">@Secured</a></h4>
<p>åˆ¤æ–­æ˜¯å¦å…·æœ‰è§’è‰²,å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒåŒ¹é…çš„å­—ç¬¦ä¸²éœ€è¦æ·»åŠ å‰ç¼€â€ROLE_â€ã€‚</p>
<p>ä½¿ç”¨æ³¨è§£è¦æå‰å¼€å¯æ³¨è§£åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#a6e22e">@EnableGlobalMethodSecurity</span><span style="color:#f92672">(</span>securedEnabled<span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DemosecurityApplication</span><span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">){</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>DemosecurityApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span>args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ Controller</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testSecured&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#a6e22e">@Secured</span><span style="color:#f92672">({</span><span style="color:#e6db74">&#34;ROLE_normal&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;ROLE_admin&#34;</span><span style="color:#f92672">})</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">helloUser</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hello,user&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#a6e22e">@Secured</span><span style="color:#f92672">({</span><span style="color:#e6db74">&#34;ROLE_normal&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;Role_ç®¡ç†å‘˜&#34;</span><span style="color:#f92672">})</span>
</code></pre></div><h4 id="82-preauthorizehttpsgithubcompreauthorize">8.2 <a href="https://github.com/PreAuthorize">@PreAuthorize</a></h4>
<p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½</p>
<p><a href="https://github.com/EnableGlobalMethodSecurity">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p>
<p><a href="https://github.com/PreAuthorize">@PreAuthorize</a> : æ³¨è§£é€‚åˆè¿›å…¥æ–¹æ³•å‰çš„æƒé™éªŒè¯,<a href="https://github.com/PreAuthorize">@PreAuthorize</a> å¯ä»¥å°†ç™»å½•ç”¨æˆ·çš„roles/permissionså‚æ•°ä¼ å…¥åˆ°æ–¹æ³•ä¸­ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/preAuthorize&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#a6e22e">@PreAuthorize</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hasAnyAuthority(&#39;menu:system&#39;)&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">preAuthorize</span><span style="color:#f92672">(){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;preAuthorize&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;preAuthorize&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="83-postauthorizehttpsgithubcompostauthorize">8.3 <a href="https://github.com/PostAuthorize">@PostAuthorize</a></h4>
<p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½:</p>
<p><a href="https://github.com/EnableGlobalMethodSecurity">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p>
<p><a href="https://github.com/PostAuthorize">@PostAuthorize</a> æ³¨è§£ä½¿ç”¨å¹¶ä¸å¤š,åœ¨æ–¹æ³•æ‰§è¡Œåå†è¿›è¡Œæƒé™éªŒè¯ï¼Œé€‚åˆéªŒè¯å¸¦æœ‰è¿”å›å€¼çš„æƒé™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testPostAuthorize&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#a6e22e">@PostAuthorzie</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hasAnyAuthorize(&#39;menu:system&#39;)&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">preAuthorize</span><span style="color:#f92672">(){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;test-PostAuthorize&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;PostAuthorize&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="84-postfilterhttpsgithubcompostfilter">8.4 <a href="https://github.com/PostFilter">@PostFilter</a></h4>
<p><a href="https://github.com/PostFilter">@PostFilter</a> : æƒé™éªŒè¯ä¹‹åå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤,ç•™ä¸‹ç”¨æˆ·åæ˜¯admin1çš„æ•°æ®</p>
<p>è¡¨è¾¾å¼ä¸­çš„filterObjectå¼•ç”¨çš„æ˜¯æ–¹æ³•è¿”å›å€¼Listä¸­çš„æŸä¸€ä¸ªå…ƒç´ </p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getAll&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@PreAuthorize</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hasRole(&#39;ROLE_ç®¡ç†å‘˜&#39;)&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@PostFilter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;filterObject.username==&#39;admin1&#39;&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>UserInfo<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAllUser</span><span style="color:#f92672">(){</span>
    ArrayList<span style="color:#f92672">&lt;</span>UserInfo<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> UserInfo<span style="color:#f92672">(</span>1l<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;admin1&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;6666&#34;</span><span style="color:#f92672">));</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> UserInfo<span style="color:#f92672">(</span>2l<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;admin2&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;6666&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#66d9ef">return</span> list<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="85-prefilterhttpsgithubcomprefilter">8.5 <a href="https://github.com/PreFilter">@PreFilter</a></h4>
<p><a href="https://github.com/PreFilter">@PreFilter</a> : è¿›å…¥æ§åˆ¶å™¨ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getTestPreFilter&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@PreAuthorize</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hasRole(&#39;ROLE_ç®¡ç†å‘˜&#39;)&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@PreFilter</span><span style="color:#f92672">(</span>value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;filterObject.id%2==0&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResonseBody</span>
<span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>UserInfo<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getTestPreFilter</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestBody</span> List<span style="color:#f92672">&lt;</span>UserInfo<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">){</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">(</span>t<span style="color:#f92672">-&gt;{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>t<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;\t&#34;</span><span style="color:#f92672">+</span>t<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">});</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="9-ç”¨æˆ·æ³¨é”€">9. ç”¨æˆ·æ³¨é”€</h3>
<p>åœ¨é…ç½®ç±»ä¸­æ·»åŠ é€€å‡ºæ˜ å°„åœ°å€</p>
<pre><code>http.logout().logoutUrl(&quot;/logout&quot;).logoutSuccessUrl(&quot;/index&quot;).permitAll();
</code></pre><h3 id="10-è‡ªåŠ¨ç™»å½•">10. è‡ªåŠ¨ç™»å½•</h3>
<p><img src="D:%5CHugo%5Chugo_0.75.1_Windows-64bit%5Cblog%5Ccontent%5Cposts%5CSpringSecurity%5CrikcLoverikcLoveimage-20210210005345863.png" alt="image-20210210005345863"></p>
<p><img src="D:%5CHugo%5Chugo_0.75.1_Windows-64bit%5Cblog%5Ccontent%5Cposts%5CSpringSecurity%5CrikcLoverikcLoveimage-20210210005636400.png" alt="image-20210210005636400"></p>
<p>ç¬¬ä¸€æ­¥ : åˆ›å»ºæ•°æ®åº“è¡¨</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>persisent_logins<span style="color:#f92672">`</span>(
    <span style="color:#f92672">`</span>username<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#f92672">`</span>series<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#f92672">`</span>token<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#f92672">`</span>last_used<span style="color:#f92672">`</span> <span style="color:#66d9ef">timestamp</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>,
    <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(<span style="color:#f92672">`</span>series<span style="color:#f92672">`</span>)
)ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;
</code></pre></div><p>ç¬¬äºŒæ­¥ : é…ç½®ç±»,æ³¨å…¥æ•°æ®æº,é…ç½®æ“ä½œæ•°æ®åº“å¯¹è±¡</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Autowired</span>
<span style="color:#66d9ef">private</span> DataSource dataSource<span style="color:#f92672">;</span>
<span style="color:#a6e22e">@Bean</span>
<span style="color:#66d9ef">public</span> PersistentTokenRepository <span style="color:#a6e22e">persistentTokenRespository</span><span style="color:#f92672">(){</span>
    JdbcTokenRepositoryImpl jdbcTokenRepositoryImpl <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JdbcTokenRepositoryImpl<span style="color:#f92672">();</span>
    jdbcTokenRepositoryImpl<span style="color:#f92672">.</span><span style="color:#a6e22e">setDataSource</span><span style="color:#f92672">(</span>dataSource<span style="color:#f92672">);</span>
    <span style="color:#75715e">//è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//jdbcTokenRepositoryImpl.setCreateTableOnStartup(true);
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> jdbcTokenRepositoryImpl<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">.</span><span style="color:#a6e22e">and</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rememberMe</span><span style="color:#f92672">().</span><span style="color:#a6e22e">tokenRespository</span><span style="color:#f92672">(</span>persistentTokenRepository<span style="color:#f92672">())</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">tokenValiditySeconds</span><span style="color:#f92672">(</span>60<span style="color:#f92672">)</span><span style="color:#75715e">//è®¾ç½®æœ‰æ•ˆæ—¶é•¿å•ä½æ˜¯ç§’
</span><span style="color:#75715e"></span>    <span style="color:#f92672">.</span><span style="color:#a6e22e">userDetailsService</span><span style="color:#f92672">(</span>userDetailsService<span style="color:#f92672">)</span>
</code></pre></div><p>ç¬¬ä¸‰æ­¥ : é¡µé¢æ·»åŠ è®°ä½æˆ‘å¤é€‰æ¡†</p>
<pre><code>è®°ä½æˆ‘ :&lt;input type=&quot;checkbox&quot; name=&quot;remember-me&quot; title=&quot;è®°ä½å¯†ç &quot;/&gt;&lt;br/&gt;
æ­¤å¤„ : name å±æ€§å¿…é¡»ä¸º remember-me,ä¸èƒ½æ”¹ä¸ºå…¶ä»–å€¼
</code></pre><h3 id="11-csrfåŠŸèƒ½">11. CSRFåŠŸèƒ½</h3>
<p>è·¨åŸŸè¯·æ±‚ä¼ªé€ (è‹±è¯­ : Cross-site request forgery),ä¹Ÿè¢«ç§°ä¸ºone-clickattackæˆ–è€…session riding,é€šå¸¸ç¼©å†™ä¸ºCSRFæˆ–è€…XSRF,æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚è·Ÿè·¨ç½‘ç«™è„šæœ¬(XSS)ç›¸æ¯”,XSSåˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRFåˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»ã€‚</p>
<p>è·¨åŸŸè¯·æ±‚æ”»å‡»ï¼Œç®€å•çš„è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œ(å¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“)ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»è¿è¡Œã€‚è¿™åˆ©ç”¨äº†Webä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ : <strong>==ç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨,å´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚==</strong></p>
<p>ä»Spring Security 4.0 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¼€å¯CSRFä¿æŠ¤ï¼Œä»¥é˜²æ­¢CSRFæ”»å‡»åº”ç”¨ç¨‹åºï¼ŒSpring Security CSRF ä¼šé’ˆå¯¹PATCH,POST,PUTå’ŒDELETEæ–¹æ³•è¿›è¡Œé˜²æŠ¤ã€‚</p>
<p>Spring Security å®ç°CSRFçš„åŸç† :</p>
<ul>
<li>ç”ŸæˆcsrfTokenä¿å­˜åˆ°HttpSessionæˆ–è€…Cookieä¸­.</li>
</ul>
<p>æ¡ˆä¾‹ :</p>
<p>åœ¨ç™»å½•é¡µé¢æ·»åŠ ä¸€ä¸ªéšè—åŸŸ :</p>
<pre><code>&lt;input type=&quot;hidden&quot; th:if=&quot;${_csrf}!=null&quot; th:value=&quot;${_csrf.token}&quot; name=&quot;_csrf&quot;/&gt;
</code></pre><p>å…³é—­å®‰å…¨é…ç½®çš„ç±»ä¸­çš„csrf :</p>
<pre><code>//http.csrf().disable();
</code></pre><p>æ·»åŠ ä¾èµ–</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--å¯¹thymeleafæ·»åŠ  Spring Securityæ ‡ç­¾æ”¯æŒ--&gt;</span>
<span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.thymeleaf.extras<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>thymeleaf-extras-springsecurity5<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Kayleh </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://kayleh.top/springsecurity/>https://kayleh.top/springsecurity/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                æœ¬æ–‡é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯
            </p>
            
    </div>

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://kayleh.top">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://kayleh.top/improve-robustness-1/" class="prev" rel="prev" title="Improve Robustness (1)"><i class="iconfont icon-left"></i>&nbsp;Improve Robustness (1)</a>
         
        
        <a href="https://kayleh.top/note/" class="next" rel="next" title="todoList">todoList&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <script async="" src="https://widget.daovoice.io/widget/38b1c911.js" charset="utf-8"></script>
    <script data-ad-client="ca-pub-7457165067653912" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      daovoice('init', {
        app_id: "38b1c911"
      });
      daovoice('update');
      </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle"style="display:inline-block;width:728px;height:90px"data-ad-client="ca-pub-7457165067653912"data-ad-slot="9837525717"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?2cd1dc193190f18fed292accb735c684";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://kayleh.top">Kayleh</a> | </span> 
         

         
         <div class="busuanzi">
            
            <span>
                visitors:
                <span id="busuanzi_value_site_pv"></span>
            </span>

            
            
            
            
            
            <script async
                src="https://cdn.jsdelivr.net/gh/kayleh/cdn2/busuanzi/busuanzi.pure.mini.js"></script>

        </div>
		  
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
