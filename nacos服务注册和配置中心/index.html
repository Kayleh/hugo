<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Kayleh">
  
  
  
  <link rel="prev" href="https://kayleh.top/%E6%8E%A5%E5%85%A5%E8%B0%B7%E6%AD%8C%E5%B9%BF%E5%91%8A%E8%81%94%E7%9B%9Fadsense/" />
  <link rel="next" href="https://kayleh.top/gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/" />
  <link rel="canonical" href="https://kayleh.top/nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Nacos服务注册和配置中心 | Kayleh
       
  </title>
  <meta name="title" content="Nacos服务注册和配置中心 | Kayleh">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/kayleh.top"
    },
    "articleSection" : "posts",
    "name" : "Nacos服务注册和配置中心",
    "headline" : "Nacos服务注册和配置中心",
    "description" : "\u003cp\u003eNacos\u003c\/p\u003e",
    "inLanguage" : "en-us",
    "author" : "Kayleh",
    "creator" : "Kayleh",
    "publisher": "Kayleh",
    "accountablePerson" : "Kayleh",
    "copyrightHolder" : "Kayleh",
    "copyrightYear" : "2020",
    "datePublished": "2020-08-21 17:44:55 \u002b0800 CST",
    "dateModified" : "2020-08-21 17:44:55 \u002b0800 CST",
    "url" : "https:\/\/kayleh.top\/nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83\/",
    "wordCount" : "1620",
    "keywords" : [ "DistributedMicroservices", "Kayleh"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/" title="">Home</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kayleh.top">Kayleh</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/" title="">Home</a>
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Nacos服务注册和配置中心</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://kayleh.top" rel="author">Kayleh</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-08-21 itemprop="datePublished">August 21, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://kayleh.top/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"> 分布式 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <p>Nacos</p>
<p>一个更易于构建云原生应用的动态服务发现，配置管理和服务管理中心</p>
<p>Nacos：Dynamic Naming and Configuration Service</p>
<p>Nacos就是注册中心+配置中心的组合等价于 Nacos = Eureka+Config+Bus</p>
<p><strong>能干嘛</strong></p>
<blockquote>
<p>替代Eureka做服务注册中心</p>
<p>替代Config做服务配置中心</p>
<p><a href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></p>
<p><a href="https://nacos.io/zh-cn/index.html">https://nacos.io/zh-cn/index.html</a></p>
<p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></p>
</blockquote>
<p>各种注册中心比较</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/1.png" alt="1597916860197"></p>
<h3 id="安装并运行nacos">安装并运行Nacos</h3>
<p>1本地Java8+Maven环境已经OK</p>
<p>2先从官网下载Nacos</p>
<blockquote>
<p><a href="https://github.com/alibaba/nacos/releases/tag/1.1.4">https://github.com/alibaba/nacos/releases/tag/1.1.4</a></p>
</blockquote>
<p>3解压安装包，直接运行bin目录下的startup.cmd</p>
<p>4命令运行成功后直接访问</p>
<blockquote>
<p>http://localhost:8848/nacos</p>
<p>默认账号密码都是nacos</p>
</blockquote>
<p>结果页面</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/58.png" alt="1597916943447"></p>
<h2 id="nacos作为服务注册中心演示">Nacos作为服务注册中心演示</h2>
<h3 id="基于nacos的服务提供者">基于Nacos的服务提供者</h3>
<p>新建Module</p>
<blockquote>
<p>cloudalibaba-provider-payment9001</p>
</blockquote>
<p>父POM</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span>
<span style="color:#f92672">&lt;dependency&gt;</span>
  <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
  <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span style="color:#f92672">&lt;/artifactId&gt;</span>
  <span style="color:#f92672">&lt;version&gt;</span>2.1.0.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
  <span style="color:#f92672">&lt;type&gt;</span>pom<span style="color:#f92672">&lt;/type&gt;</span>
  <span style="color:#f92672">&lt;scope&gt;</span>import<span style="color:#f92672">&lt;/scope&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>本模块POM</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>fastjson<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.2.62<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
 <span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>yaml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">server</span>:
  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9001</span>

<span style="color:#f92672">spring</span>:
  <span style="color:#f92672">application</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nacos-payment-provider</span>
  <span style="color:#f92672">cloud</span>:
    <span style="color:#f92672">nacos</span>:
      <span style="color:#f92672">discovery</span>:
        <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848 #配置Nacos地址</span>

<span style="color:#f92672">management</span>:
  <span style="color:#f92672">endpoints</span>:
    <span style="color:#f92672">web</span>:
      <span style="color:#f92672">exposure</span>:
        <span style="color:#f92672">include</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</code></pre></div><p>主启动类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@EnableDiscoveryClient</span>
<span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PaymentMain9001</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>PaymentMain9001<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span>args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>业务类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba.controller<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Value<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@RestController</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PaymentController</span>
<span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${server.port}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">private</span> String serverPort<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/payment/nacos/{id}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getPayment</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Integer id<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;nacos registry, serverPort: &#34;</span><span style="color:#f92672">+</span> serverPort<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\t id&#34;</span><span style="color:#f92672">+</span>id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试</p>
<pre><code>http://localhost:9001/payment/nacos/1
</code></pre><p>nacos控制台</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/3.png" alt="1597917114444"></p>
<p>nacos服务注册中心+服务提供者9001都ok了</p>
<p>为了演示nacos的负载均衡，参照9001新建9002</p>
<p>新建</p>
<blockquote>
<p>cloudalibaba-provider-payment9002</p>
</blockquote>
<p>9002其他步骤你懂的</p>
<p>或者取巧不想新建重复体力劳动，直接拷贝虚拟端口映射</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/4.png" alt="1597917265960"></p>
<p><!-- raw HTML omitted --></p>
<h3 id="基于nacos的服务消费者">基于Nacos的服务消费者</h3>
<p>新建Module</p>
<blockquote>
<p>cloudalibaba-consumer-nacos-order83</p>
</blockquote>
<p>POM</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#75715e">&lt;!--SpringCloud ailibaba nacos --&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.kayleh.springcloud<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>cloud-api-commons<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>${project.version}<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>为什么nacos支持负载均衡</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/6.png" alt="1597917355359"></p>
<p>yaml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">server</span>:
  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">83</span>

<span style="color:#f92672">spring</span>:
  <span style="color:#f92672">application</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nacos-order-consumer</span>
  <span style="color:#f92672">cloud</span>:
    <span style="color:#f92672">nacos</span>:
      <span style="color:#f92672">discovery</span>:
        <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848</span>

<span style="color:#f92672">service-url</span>:
  <span style="color:#f92672">nacos-user-service</span>: <span style="color:#ae81ff">http://nacos-payment-provider</span>
</code></pre></div><p>主启动</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@EnableDiscoveryClient</span>
<span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderNacosMain83</span>
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>OrderNacosMain83<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span>args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>业务类</p>
<p>ApplicationContextBean</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba.config<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.client.RestTemplate<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApplicationContextConfig</span>
<span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#a6e22e">@LoadBalanced</span>
    <span style="color:#66d9ef">public</span> RestTemplate <span style="color:#a6e22e">getRestTemplate</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> RestTemplate<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>OrderNacosController</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba.controller<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Value<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.client.RestTemplate<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.annotation.Resource<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@Slf4j</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderNacosController</span>
<span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Resource</span>
    <span style="color:#66d9ef">private</span> RestTemplate restTemplate<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${service-url.nacos-user-service}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">private</span> String serverURL<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/consumer/payment/nacos/{id}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">paymentInfo</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long id<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> restTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">getForObject</span><span style="color:#f92672">(</span>serverURL<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/payment/nacos/&#34;</span><span style="color:#f92672">+</span>id<span style="color:#f92672">,</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>测试</p>
<p>nacos控制台</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/7.png" alt="1597917596670"></p>
<p>访问</p>
<blockquote>
<p>http://localhost:83/consumer/payment/nacos/13</p>
</blockquote>
<p>83访问9001/9002，轮询负载OK</p>
<h5 id="服务注册中心对比">服务注册中心对比</h5>
<p>各种注册中心对比</p>
<p>Nacos全景图所示</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/8.png" alt="1597917654952"></p>
<p>Nacos和CAP</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/9.png" alt="1597917671204"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/10.png" alt="1597917730065"></p>
<h5 id="nacos支持ap和cp模式的切换">Nacos支持AP和CP模式的切换</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/11.png" alt="1597917749721"></p>
<pre><code>curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP'
</code></pre><h2 id="nacos作为服务配置中心演示">Nacos作为服务配置中心演示</h2>
<h3 id="nacos作为配置中心-基础配置">Nacos作为配置中心-基础配置</h3>
<p>cloudalibaba-config-nacos-client3377</p>
<p>POM</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#75715e">&lt;!--nacos-config--&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#75715e">&lt;!--nacos-discovery--&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#75715e">&lt;!--web + actuator--&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#75715e">&lt;!--一般基础配置--&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>YML</p>
<p>为什么配置两个</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/12.png" alt="1597999398581"></p>
<blockquote>
<p>bootstrap</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">server</span>:
  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">3377</span>

<span style="color:#f92672">spring</span>:
  <span style="color:#f92672">application</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nacos-config-client</span>
  <span style="color:#f92672">cloud</span>:
    <span style="color:#f92672">nacos</span>:
      <span style="color:#f92672">discovery</span>:
        <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848 #服务注册中心地址</span>
      <span style="color:#f92672">config</span>:
        <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848 #配置中心地址</span>
        <span style="color:#f92672">file-extension</span>: <span style="color:#ae81ff">yaml #指定yaml格式的配置</span>
</code></pre></div><p>application</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">spring</span>:
  <span style="color:#f92672">profiles</span>:
    <span style="color:#f92672">active</span>: <span style="color:#ae81ff">dev</span>
</code></pre></div></blockquote>
<p>主启动类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.boot.SpringApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@EnableDiscoveryClient</span>
<span style="color:#a6e22e">@SpringBootApplication</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NacosConfigClientMain3377</span>
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SpringApplication<span style="color:#f92672">.</span><span style="color:#a6e22e">run</span><span style="color:#f92672">(</span>NacosConfigClientMain3377<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>业务类</p>
<p>ConfigClientController</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.kayleh.springcloud.alibaba.controller<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Value<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.cloud.context.config.annotation.RefreshScope<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@RefreshScope</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConfigClientController</span>
<span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${config.info}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">private</span> String configInfo<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/config/info&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getConfigInfo</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> configInfo<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>@RefreshScope</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/13.png" alt="1597999398581"></p>
<h4 id="在nacos中添加配置信息">在Nacos中添加配置信息</h4>
<h5 id="nacos中的匹配规则">Nacos中的匹配规则</h5>
<p><strong>理论</strong></p>
<p>Nacos中的dataid的组成格式与SpringBoot配置文件中的匹配规则</p>
<p><a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/14.png" alt="1597999707395"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/15.png" alt="1597999752185"></p>
<p><strong>实操</strong></p>
<p>1.配置新增</p>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/16.png" alt="1597999802135"></p>
<p>nacos-config-client-dev</p>
</blockquote>
<p>2.Nacos界面配置对应</p>
<blockquote>
<pre><code>config:
    info: nacos config center,version = 1,from nacos config center, nacos-config-client-dev.yaml, version=1
</code></pre><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/17.png" alt="1598006810118"></p>
<p>设置DataId</p>
<p>公式:</p>
<p><code>${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}</code></p>
<p><code>prefix</code>默认为<code>spring.application.name</code>的值</p>
<p><code>spring.profile.active</code>既为当前环境对应的<code>profile</code>,可以通过配置项<code>spring.profile.active</code> 来配置</p>
<p><code>file-exetension</code>为配置内容的数据格式，可以通过配置项<code>spring.cloud.nacos.config.file-extension</code>配置</p>
<p>总结:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/18.png" alt="1598006888126"></p>
</blockquote>
<p>3.历史配置</p>
<h4 id="测试">测试</h4>
<p>启动前需要在nacos客户端-配置管理-配置管理栏目下有没有对应的yaml配置文件</p>
<p>运行cloud-config-nacos-client3377的主启动类</p>
<p>调用接口查看配置信息</p>
<blockquote>
<p>http://localhost:3377/config/info</p>
</blockquote>
<h4 id="自带动态刷新">自带动态刷新</h4>
<p>修改下Nacos中的yaml配置文件，再次调用查看配置的接口，就会发现配置已经刷新</p>
<h3 id="nacos作为配置中心-分类配置">Nacos作为配置中心-分类配置</h3>
<p>问题</p>
<blockquote>
<p>多环境多项目管理</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/19.png" alt="1598007094349"></p>
</blockquote>
<p>Nacos的图形化管理界面</p>
<blockquote>
<p>配置管理</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/20.png" alt="1598007142269"></p>
<p>命名空间</p>
<p><!-- raw HTML omitted --></p>
</blockquote>
<h5 id="namespacegroupdata-id三者关系为什么这么设计">Namespace+Group+Data ID三者关系？为什么这么设计？</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/22.png" alt="1598007201161"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/23.png" alt="1598007216472"></p>
<h4 id="case">Case</h4>
<h5 id="一dataid方案"><strong>一、DataID方案</strong></h5>
<ol>
<li>
<p>指定spring.profile.active和配置文件的DataID来使不同环境下读取不同的配置</p>
</li>
<li>
<p>默认空间+默认分组+新建dev和test两个DataID</p>
</li>
</ol>
<p>新建dev配置DataID</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/24.png" alt="1598007306224"></p>
<p>新建test配置DataID</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/25.png" alt="1598007322942"></p>
<p><strong>通过spring.profile.active属性就能进行多环境下配置文件的读取</strong>  <img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/26.png" alt="1598010338263"></p>
<p>测试</p>
<blockquote>
<p>http://localhost:3377/config/info</p>
</blockquote>
<p>配置是什么就加载什么</p>
<p>test</p>
<h5 id="二group方案"><strong>二、Group方案</strong></h5>
<p>通过Group实现环境区分</p>
<p>新建Group</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/27.png" alt="1598010952482"></p>
<p>在nacos图形界面控制台上面新建配置文件DataID</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/28.png" alt="1598010985237"></p>
<p>bootstrap+application</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/29.png" alt="1598011032814"></p>
<p>在config下增加一条group的配置即可。可配置为DEV_GROUP或TEST_GROUP</p>
<h5 id="三namespace方案">三、Namespace方案</h5>
<p>新建dev/test的Namespace</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/30.png" alt="1598011094792"></p>
<p>回到服务管理-服务列表查看</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/31.png" alt="1598011118483"></p>
<p>按照域名配置填写</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/32.png" alt="1598011149802"></p>
<p>YML</p>
<p>bootstrap</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/59.png" alt="1598264395915"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">namespace</span>: 

</code></pre></div><p>application</p>
<h1 id="nacos集群和持久化配置">Nacos集群和持久化配置</h1>
<h2 id="是什么">是什么？</h2>
<blockquote>
<p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p>
</blockquote>
<p><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --></p>
<p>按照上述，我们需要mysql数据库</p>
<blockquote>
<p><a href="https://nacos.io/zh-cn/docs/deployment.html">https://nacos.io/zh-cn/docs/deployment.html</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/36.png" alt="1598011363176"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/37.png" alt="1598011391934"></p>
<h2 id="nacos持久化配置解释">Nacos持久化配置解释</h2>
<p>Nacos默认自带的是嵌入式数据库derby</p>
<blockquote>
<p><a href="https://github.com/alibaba/nacos/blob/develop/config/pom.xml">https://github.com/alibaba/nacos/blob/develop/config/pom.xml</a></p>
</blockquote>
<p>derby到mysql切换配置步骤</p>
<blockquote>
<p>nacos-server-1.1.4\nacos\conf目录下找到sql脚本</p>
<p>nacos-mysql.sql</p>
<p>执行脚本</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> nacos_config;
USE nacos_config;

<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = config_info   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>config_info<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span>    <span style="color:#e6db74">&#39;data_id&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>content<span style="color:#f92672">`</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;content&#39;</span>,
<span style="color:#f92672">`</span>md5<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;md5&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#f92672">`</span>src_user<span style="color:#f92672">`</span> text <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source user&#39;</span>,
<span style="color:#f92672">`</span>src_ip<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source ip&#39;</span>,
<span style="color:#f92672">`</span>app_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;租户字段&#39;</span>,
<span style="color:#f92672">`</span>c_desc<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">256</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>c_use<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>effect<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span><span style="color:#66d9ef">type</span><span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>c_schema<span style="color:#f92672">`</span> text,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_configinfo_datagrouptenant<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;config_info&#39;</span>;

<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = config_info_aggr   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>config_info_aggr<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;data_id&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;group_id&#39;</span>,
<span style="color:#f92672">`</span>datum_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;datum_id&#39;</span>,
<span style="color:#f92672">`</span>content<span style="color:#f92672">`</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;内容&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#f92672">`</span>app_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;租户字段&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_configinfoaggr_datagrouptenantdatum<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>datum_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;增加租户字段&#39;</span>;


<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = config_info_beta   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>config_info_beta<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;data_id&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;group_id&#39;</span>,
<span style="color:#f92672">`</span>app_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;app_name&#39;</span>,
<span style="color:#f92672">`</span>content<span style="color:#f92672">`</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;content&#39;</span>,
<span style="color:#f92672">`</span>beta_ips<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;betaIps&#39;</span>,
<span style="color:#f92672">`</span>md5<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;md5&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#f92672">`</span>src_user<span style="color:#f92672">`</span> text <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source user&#39;</span>,
<span style="color:#f92672">`</span>src_ip<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source ip&#39;</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;租户字段&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_configinfobeta_datagrouptenant<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;config_info_beta&#39;</span>;

<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = config_info_tag   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>config_info_tag<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;data_id&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;group_id&#39;</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tenant_id&#39;</span>,
<span style="color:#f92672">`</span>tag_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tag_id&#39;</span>,
<span style="color:#f92672">`</span>app_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;app_name&#39;</span>,
<span style="color:#f92672">`</span>content<span style="color:#f92672">`</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;content&#39;</span>,
<span style="color:#f92672">`</span>md5<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;md5&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#f92672">`</span>src_user<span style="color:#f92672">`</span> text <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source user&#39;</span>,
<span style="color:#f92672">`</span>src_ip<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;source ip&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_configinfotag_datagrouptenanttag<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tag_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;config_info_tag&#39;</span>;

<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = config_tags_relation   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>config_tags_relation<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>tag_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tag_name&#39;</span>,
<span style="color:#f92672">`</span>tag_type<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">64</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tag_type&#39;</span>,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;data_id&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;group_id&#39;</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tenant_id&#39;</span>,
<span style="color:#f92672">`</span>nid<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>nid<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_configtagrelation_configidtag<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tag_name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tag_type<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_tenant_id<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;config_tag_relation&#39;</span>;

<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = group_capacity   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>group_capacity<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;主键ID&#39;</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;Group ID，空字符表示整个集群&#39;</span>,
<span style="color:#f92672">`</span>quota<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;配额，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span><span style="color:#66d9ef">usage</span><span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;使用量&#39;</span>,
<span style="color:#f92672">`</span>max_size<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span>max_aggr_count<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;聚合子配置最大个数，，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span>max_aggr_size<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span>max_history_count<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;最大变更历史数量&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_group_id<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;集群、各Group容量信息表&#39;</span>;

<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = his_config_info   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>his_config_info<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">64</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>nid<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>group_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>app_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;app_name&#39;</span>,
<span style="color:#f92672">`</span>content<span style="color:#f92672">`</span> longtext <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>md5<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span>,
<span style="color:#f92672">`</span>src_user<span style="color:#f92672">`</span> text,
<span style="color:#f92672">`</span>src_ip<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>op_type<span style="color:#f92672">`</span> char(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;租户字段&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>nid<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_gmt_create<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_gmt_modified<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_did<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>data_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;多租户改造&#39;</span>;


<span style="color:#75715e">/******************************************/</span>
<span style="color:#75715e">/*   数据库全名 = nacos_config   */</span>
<span style="color:#75715e">/*   表名称 = tenant_capacity   */</span>
<span style="color:#75715e">/******************************************/</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>tenant_capacity<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;主键ID&#39;</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;Tenant ID&#39;</span>,
<span style="color:#f92672">`</span>quota<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;配额，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span><span style="color:#66d9ef">usage</span><span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;使用量&#39;</span>,
<span style="color:#f92672">`</span>max_size<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span>max_aggr_count<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;聚合子配置最大个数&#39;</span>,
<span style="color:#f92672">`</span>max_aggr_size<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;</span>,
<span style="color:#f92672">`</span>max_history_count<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;最大变更历史数量&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;2010-05-05 00:00:00&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_tenant_id<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;租户容量信息表&#39;</span>;


<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>tenant_info<span style="color:#f92672">`</span> (
<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;id&#39;</span>,
<span style="color:#f92672">`</span>kp<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;kp&#39;</span>,
<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tenant_id&#39;</span>,
<span style="color:#f92672">`</span>tenant_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tenant_name&#39;</span>,
<span style="color:#f92672">`</span>tenant_desc<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">256</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;tenant_desc&#39;</span>,
<span style="color:#f92672">`</span>create_source<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;create_source&#39;</span>,
<span style="color:#f92672">`</span>gmt_create<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
<span style="color:#f92672">`</span>gmt_modified<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;修改时间&#39;</span>,
<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>uk_tenant_info_kptenantid<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>kp<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>),
<span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_tenant_id<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>tenant_id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tenant_info&#39;</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> users (
 username varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
 password varchar(<span style="color:#ae81ff">500</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 enabled boolean <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> roles (
 username varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 <span style="color:#66d9ef">role</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (username, password, enabled) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;nacos&#39;</span>, <span style="color:#e6db74">&#39;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#39;</span>, <span style="color:#66d9ef">TRUE</span>);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> roles (username, <span style="color:#66d9ef">role</span>) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;nacos&#39;</span>, <span style="color:#e6db74">&#39;ROLE_ADMIN&#39;</span>);
</code></pre></div><p>nacos-server-1.1.4\nacos\conf目录下找到application.properties</p>
<p>#mysql8.0+后面加上时区serverTimezone=UTC</p>
<pre><code class="language-properties" data-lang="properties">spring.datasource.platform=mysql

db.num=1
db.url.0=jdbc:mysql://11.162.196.16:3306/nacos_devtest?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=nacos_devtest
db.password=youdontknow

##################################################

spring.datasource.platform=mysql

db.num=1
db.url.0=jdbc:mysql://localhost:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=root
db.password=123456
</code></pre></blockquote>
<p>启动nacos，可以看到是个全新的空记录界面，以前是记录进derby</p>
<h2 id="linux版nacosmysql生产环境配置">Linux版Nacos+MySQL生产环境配置</h2>
<blockquote>
<p>预计需要，1个nginx+3个nacos注册中心+1个mysql</p>
</blockquote>
<p>Nacos下载linux版本</p>
<p><!-- raw HTML omitted --></p>
<blockquote>
<p><a href="https://github.com/alibaba/nacos/releases/tag/1.1.4">https://github.com/alibaba/nacos/releases/tag/1.1.4</a></p>
<p>nacos-server-1.1.4.tar.gz</p>
<p>解压到/opt</p>
<p>拷贝</p>
<pre><code>cp -r nacos /mynacos/
</code></pre><p>cd  /mynacos/nacos/</p>
<p>cd bin</p>
<p>执行,执行之前把原始的配置备份一遍。</p>
<pre><code>cp startup.sh startup.sh.bk
startup.sh
</code></pre><p>解压后安装</p>
</blockquote>
<h2 id="集群配置步骤">集群配置步骤</h2>
<h3 id="1linux服务器上mysql数据库配置">1.Linux服务器上mysql数据库配置</h3>
<h5 id="sql脚本在哪里">SQL脚本在哪里</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/390.png" alt="1598011816083"></p>
<h5 id="sql语句源文件">sql语句源文件</h5>
<p>nacos-mysql.sql</p>
<h5 id="自己linux机器上的mysql数据库黏贴">自己Linux机器上的Mysql数据库黏贴</h5>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/40.png" alt="1598011996589"></p>
<h3 id="2applicationproperties配置">2.application.properties配置</h3>
<h4 id="位置">位置</h4>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/41.png" alt="1598012047300"></p>
<h4 id="内容">内容</h4>
<pre><code class="language-properties" data-lang="properties">spring.datasource.platform=mysql
 
db.num=1
db.url.0=jdbc:mysql://1.7.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=root
db.password=HF_mysql_654321
</code></pre><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/42.png" alt="1598012185308"></p>
<pre><code>mysql  授权远程访问
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
flush privileges;
</code></pre><h3 id="3linux服务器上nacos的集群配置clusterconf">3.Linux服务器上nacos的集群配置cluster.conf</h3>
<p>梳理出3台nacos机器的不同服务端口号</p>
<p>复制出cluster.conf</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/43.png" alt="1598012321701"></p>
<h4 id="内容-1">内容</h4>
<p><!-- raw HTML omitted --></p>
<p>这个IP不能写127.0.0.1,必须是Linux命令hostname -i能够识别的IP</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/45.png" alt="1598012433063"></p>
<p>或者ifconfig</p>
<h3 id="4编辑nacos的启动脚本startupsh使它能够接受不同的启动端">4.编辑Nacos的启动脚本startup.sh，使它能够接受不同的启动端</h3>
<h4 id="mynacosnacosbin目录下有startupsh">/mynacos/nacos/bin目录下有startup.sh</h4>
<p>在什么地方，修改什么，怎么修改</p>
<p>思考</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/46.png" alt="1598012484557"></p>
<p>修改内容</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/47.png" alt="1598012508369"></p>
<pre><code>cp startup.sh startup.sh.bk
</code></pre><p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/48.png" alt="1598012527781"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/49.png" alt="1598012546461"></p>
<p>执行方式</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/50.png" alt="1598012636318"></p>
<h3 id="5nginx的配置由它作为负载均衡器">5.Nginx的配置，由它作为负载均衡器</h3>
<p>修改nginx的配置文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/51.png" alt="1598012677966"></p>
<p>nginx.conf</p>
<pre><code>upstream cluster{      
server 127.0.0.1:3333;
server 127.0.0.1:4444;
server 127.0.0.1:5555;
}
server{
listen 1111;
server_name localhost;
location /{
     proxy_pass http://cluster;
                                                    
}
</code></pre>
<p>&hellip;.省略</p>
<p><!-- raw HTML omitted --></p>
<p>按照指定启动</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/53.png" alt="1598013342566"></p>
<pre><code class="language-linux" data-lang="linux">ps -ef|grep nacos|grep -v grep |wc -l
--------------
3
</code></pre><p>3个微服务已启动</p>
<h3 id="6截止到此处1个nginx3个nacos注册中心1个mysql">6.截止到此处，1个Nginx+3个nacos注册中心+1个mysql</h3>
<p>测试通过nginx访问nacos</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">https:<span style="color:#75715e">//写你自己虚拟机的ip:1111/nacos/#/login
</span></code></pre></div><p>新建一个配置测试</p>
<p><!-- raw HTML omitted --></p>
<pre><code>mysql&gt; select * from config_info;
</code></pre><p>linux服务器的mysql插入一条记录</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/55.png" alt="1598013436552"></p>
<h4 id="测试-1">测试</h4>
<p>微服务cloudalibaba-provider-payment9002启动注册进nacos集群</p>
<p>yml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">server-addr</span>:  <span style="color:#ae81ff">写你自己的虚拟机ip:1111</span>
 
</code></pre></div><p>结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/56.png" alt="1598013518452"></p>
<p>高可用小总结</p>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/57.png" alt="1598013576604"></p>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Kayleh </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://kayleh.top/nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/>https://kayleh.top/nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://kayleh.top/tags/distributedmicroservices/">
                    #DistributedMicroservices</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://kayleh.top">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://kayleh.top/%E6%8E%A5%E5%85%A5%E8%B0%B7%E6%AD%8C%E5%B9%BF%E5%91%8A%E8%81%94%E7%9B%9Fadsense/" class="prev" rel="prev" title="Traffic monetization:Access to Google Adsense"><i class="iconfont icon-left"></i>&nbsp;Traffic monetization:Access to Google Adsense</a>
         
        
        <a href="https://kayleh.top/gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/" class="next" rel="next" title="gulp压缩静态资源">gulp压缩静态资源&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <script async="" src="https://widget.daovoice.io/widget/38b1c911.js" charset="utf-8"></script>
    <script data-ad-client="ca-pub-7457165067653912" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle"style="display:inline-block;width:728px;height:90px"data-ad-client="ca-pub-7457165067653912"data-ad-slot="9837525717"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?2cd1dc193190f18fed292accb735c684";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://kayleh.top">Kayleh</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
