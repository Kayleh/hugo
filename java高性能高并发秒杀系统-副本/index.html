<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://kayleh.top/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://kayleh.top/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://kayleh.top/css/github.min.css' />
    <link rel="stylesheet" href='https://kayleh.top/css/github-style.css' />
    <link rel="stylesheet" href='https://kayleh.top/css/light.css' />
    <link rel="stylesheet" href='https://kayleh.top/css/dark.css' />
    <link rel="stylesheet" href='https://kayleh.top/css/syntax.css' />
    <title>Java高性能高并发秒杀系统(2) - Kayleh</title>
    
    <link rel="icon" type="image/x-icon" href='https://kayleh.top/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="1. 登录过程中，密码两次MD5加密 1.1 为啥用两次MD5哇？  第一次MD5，是针对传输安全做的MD5加密，因为http是明文传递，如果不进行加密的话，密码就直接被劫持了。 (Password1 = MD5(inputPassword,固定的salt值)，salt为字符串) 第二次MD5，是针对数据库安全做的MD5加密，保证数据库的防盗安全。若不进行二次加密，MD5值经数据库获取，可直接被MD5转换器直接转换为用户密码，不安全。 (Password2 = MD5(Password1,随机的salt值))   2. 构建数据库表 2.1 几个需要注意的点  字符集采用的是utf8mb4(most bytes 4)。简单来说，utf8mb4是utf8的超集，能够用4个字节存储更多的字符。标准UTF-8字符集编码可以用1~4个字节取编码21位字符，但是在MySQL中，utf8最多使用3个字节，像一些表情emoji和不常用的字符如“墅”需要用4个字节才能表示出来。用utf8mb4能解决以上问题。 数据库中存储了&amp;quot;动态&amp;quot;salt值   3. 针对MD5加密功能，封装了专用工具类 以下MD5包的Maven依赖了解以下
&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;commons-codec&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-codec&amp;lt;/artifactId&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-lang3&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;3.6&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; 123456789 3.1 工具类代码 public class MD5Util { //静态的salt，用于第一次MD5  private static final String salt = &amp;#34;1a2b3c4d&amp;#34;; private static String md5(String src){ //调用DigestUtils，实现md5处理  return DigestUtils.md5Hex(src); } /** * 第一次MD5处理 * @param inputPass * @return */ public static String inputPassToFormPass(String inputPass){ //这里没加“”出现了问题？？？  String pass =&amp;#34;&amp;#34; &#43; salt." />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://kayleh.top/java%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F-%E5%89%AF%E6%9C%AC/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Java高性能高并发秒杀系统(2) - Kayleh" />
<meta name="twitter:description"
  content="1. 登录过程中，密码两次MD5加密 1.1 为啥用两次MD5哇？  第一次MD5，是针对传输安全做的MD5加密，因为http是明文传递，如果不进行加密的话，密码就直接被劫持了。 (Password1 = MD5(inputPassword,固定的salt值)，salt为字符串) 第二次MD5，是针对数据库安全做的MD5加密，保证数据库的防盗安全。若不进行二次加密，MD5值经数据库获取，可直接被MD5转换器直接转换为用户密码，不安全。 (Password2 = MD5(Password1,随机的salt值))   2. 构建数据库表 2.1 几个需要注意的点  字符集采用的是utf8mb4(most bytes 4)。简单来说，utf8mb4是utf8的超集，能够用4个字节存储更多的字符。标准UTF-8字符集编码可以用1~4个字节取编码21位字符，但是在MySQL中，utf8最多使用3个字节，像一些表情emoji和不常用的字符如“墅”需要用4个字节才能表示出来。用utf8mb4能解决以上问题。 数据库中存储了&amp;quot;动态&amp;quot;salt值   3. 针对MD5加密功能，封装了专用工具类 以下MD5包的Maven依赖了解以下
&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;commons-codec&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-codec&amp;lt;/artifactId&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-lang3&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;3.6&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; 123456789 3.1 工具类代码 public class MD5Util { //静态的salt，用于第一次MD5  private static final String salt = &amp;#34;1a2b3c4d&amp;#34;; private static String md5(String src){ //调用DigestUtils，实现md5处理  return DigestUtils.md5Hex(src); } /** * 第一次MD5处理 * @param inputPass * @return */ public static String inputPassToFormPass(String inputPass){ //这里没加“”出现了问题？？？  String pass =&amp;#34;&amp;#34; &#43; salt." />
<meta name="twitter:site" content="https://kayleh.top" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://kayleh.top">


<meta property="og:type" content="article" />
<meta property="og:title" content="Java高性能高并发秒杀系统(2) - Kayleh">
<meta property="og:description"
  content="1. 登录过程中，密码两次MD5加密 1.1 为啥用两次MD5哇？  第一次MD5，是针对传输安全做的MD5加密，因为http是明文传递，如果不进行加密的话，密码就直接被劫持了。 (Password1 = MD5(inputPassword,固定的salt值)，salt为字符串) 第二次MD5，是针对数据库安全做的MD5加密，保证数据库的防盗安全。若不进行二次加密，MD5值经数据库获取，可直接被MD5转换器直接转换为用户密码，不安全。 (Password2 = MD5(Password1,随机的salt值))   2. 构建数据库表 2.1 几个需要注意的点  字符集采用的是utf8mb4(most bytes 4)。简单来说，utf8mb4是utf8的超集，能够用4个字节存储更多的字符。标准UTF-8字符集编码可以用1~4个字节取编码21位字符，但是在MySQL中，utf8最多使用3个字节，像一些表情emoji和不常用的字符如“墅”需要用4个字节才能表示出来。用utf8mb4能解决以上问题。 数据库中存储了&amp;quot;动态&amp;quot;salt值   3. 针对MD5加密功能，封装了专用工具类 以下MD5包的Maven依赖了解以下
&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;commons-codec&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-codec&amp;lt;/artifactId&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;commons-lang3&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;3.6&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; 123456789 3.1 工具类代码 public class MD5Util { //静态的salt，用于第一次MD5  private static final String salt = &amp;#34;1a2b3c4d&amp;#34;; private static String md5(String src){ //调用DigestUtils，实现md5处理  return DigestUtils.md5Hex(src); } /** * 第一次MD5处理 * @param inputPass * @return */ public static String inputPassToFormPass(String inputPass){ //这里没加“”出现了问题？？？  String pass =&amp;#34;&amp;#34; &#43; salt." />
<meta property="og:url" content="https://kayleh.top/java%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F-%E5%89%AF%E6%9C%AC/" />
<meta property="og:site_name" content="Java高性能高并发秒杀系统(2)" />
<meta property="og:image"
  content="https://kayleh.top">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2020-11-06 20:13:45 &#43;0800 CST" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://kayleh.top">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://kayleh.top">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://kayleh.top">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://kayleh.top">
                  <img class=" avatar-user"
                    src="http://cdn.jsdelivr.net/gh/kayleh/cdn/img/2.jpg"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://kayleh.top">Kayleh</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://kayleh.top/java%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F-%E5%89%AF%E6%9C%AC/">Java高性能高并发秒杀系统(2)</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Fri, 06 Nov 2020 20:13:45 &#43;0800"
                    class="no-wrap">
                    Fri, 06 Nov 2020 20:13:45 &#43;0800</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div class="file-header d-flex flex-md-items-center flex-items-start">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    2284 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/project">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      project
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><h2 id="1-登录过程中密码两次md5加密">1. 登录过程中，密码两次MD5加密</h2>
<h3 id="11-为啥用两次md5哇">1.1 为啥用两次MD5哇？</h3>
<ol>
<li>第一次MD5，是针对<code>传输安全</code>做的MD5加密，因为<code>http是明文传递</code>，如果不进行加密的话，密码就直接被劫持了。
(Password1 = MD5(inputPassword,固定的salt值)，salt为字符串)</li>
<li>第二次MD5，是针对<code>数据库安全</code>做的MD5加密，保证数据库的防盗安全。若不进行二次加密，MD5值经数据库获取，可直接被MD5转换器直接转换为用户密码，不安全。
(Password2 = MD5(Password1,随机的salt值))</li>
</ol>
<hr>
<h2 id="2-构建数据库表">2. 构建数据库表</h2>
<p><img src="https://cdn.jsdelivr.net/gh/kayleh/cdn2/Java%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F/20200709182209155.png" alt="在这里插入图片描述"></p>
<h3 id="21-几个需要注意的点">2.1 几个需要注意的点</h3>
<ul>
<li>字符集采用的是<code>utf8mb4</code>(most bytes 4)。简单来说，utf8mb4是<code>utf8的超集</code>，能够用<code>4个字节</code>存储更多的字符。标准UTF-8字符集编码可以用1~4个字节取编码21位字符，但是在<code>MySQL中，utf8最多使用3个字节</code>，像一些表情emoji和不常用的字符如“墅”需要用4个字节才能表示出来。用utf8mb4能解决以上问题。</li>
<li>数据库中存储了<code>&quot;动态&quot;salt值</code></li>
</ul>
<hr>
<h2 id="3-针对md5加密功能封装了专用工具类">3. 针对MD5加密功能，封装了专用工具类</h2>
<p>以下MD5包的Maven依赖了解以下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">        &lt;dependency&gt;
            &lt;groupId&gt;commons-codec&lt;/groupId&gt;
            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;
            &lt;version&gt;3.6&lt;/version&gt;
        &lt;/dependency&gt;
<span style="color:#ae81ff">123456789</span>
</code></pre></div><h3 id="31-工具类代码">3.1 工具类代码</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MD5Util</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//静态的salt，用于第一次MD5
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String salt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1a2b3c4d&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">md5</span><span style="color:#f92672">(</span>String src<span style="color:#f92672">){</span>
    	<span style="color:#75715e">//调用DigestUtils，实现md5处理
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> DigestUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">md5Hex</span><span style="color:#f92672">(</span>src<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 第一次MD5处理
</span><span style="color:#75715e">     * @param inputPass
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">inputPassToFormPass</span><span style="color:#f92672">(</span>String inputPass<span style="color:#f92672">){</span>
        <span style="color:#75715e">//这里没加“”出现了问题？？？
</span><span style="color:#75715e"></span>        String pass <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">+</span> salt<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> salt<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>7<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> inputPass
                <span style="color:#f92672">+</span> salt<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> salt<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>5<span style="color:#f92672">);</span>
        <span style="color:#75715e">//System.out.println(pass);
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> md5<span style="color:#f92672">(</span>pass<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
123456789101112131415161718192021222324
</code></pre></div><ul>
<li>我在第一次处理加密时，拼接<code>字符</code>时没有添加<code>&quot;&quot;</code>，出现了登录验证失败的问题</li>
</ul>
<hr>
<h2 id="4-加入jsr参数校验">4. 加入JSR参数校验</h2>
<h3 id="41-jsr参数校验">4.1 JSR参数校验</h3>
<ul>
<li>我们看如下，代码，在登录处理过程中，我们要用<code>代码</code>实现对前端传过来的id和password进行校验（我们这里是验证<code>非空</code>），引入JSR参数校验之后，能够将这些代码省去</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/do_login&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#a6e22e">@ResponseBody</span>
    <span style="color:#66d9ef">public</span> Result<span style="color:#f92672">&lt;</span>Boolean<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">doLogin</span><span style="color:#f92672">(</span>LoginVo loginVo<span style="color:#f92672">){</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span>loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>

        <span style="color:#75715e">//参数校验
</span><span style="color:#75715e"></span>        String mobile <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getMobile</span><span style="color:#f92672">();</span>
        String password <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>password<span style="color:#f92672">)){</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">PASSWORD_EMPTY</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span> ValidatorUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">isMobile</span><span style="color:#f92672">(</span>mobile<span style="color:#f92672">)){</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">MOBILE_ERROR</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        CodeMsg msg <span style="color:#f92672">=</span> miaoShaUserService<span style="color:#f92672">.</span><span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>loginVo<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">){</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">success</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
12345678910111213141516171819202122
</code></pre></div><ul>
<li>进行JSR参数校验升级</li>
</ul>
<p>我们先看一下导入的包</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
        &lt;/dependency&gt;
<span style="color:#ae81ff">1234</span>
</code></pre></div><p>我们在doLogin()方法上，加上JSR验证，<code>@Valid</code>注解</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> Result<span style="color:#f92672">&lt;</span>CodeMsg<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">doLogin</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Valid</span> LoginVo loginVo<span style="color:#f92672">)</span>
1
</code></pre></div><p>被标注的参数，我们进入它的实现类中，对其中的字段进行约束，如下（<code>@NotNull</code>，<code>@Length</code>，<code>@IsMobile</code>，其中@IsMobile是我们自定义的注解）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginVo</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@IsMobile</span>
    <span style="color:#a6e22e">@NotNull</span>
    <span style="color:#66d9ef">private</span> String mobile<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@NotNull</span>
    <span style="color:#a6e22e">@Length</span><span style="color:#f92672">(</span>min <span style="color:#f92672">=</span> 32<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
1234567891011
</code></pre></div><h3 id="42-ismobile自定义注解">4.2 @IsMobile自定义注解</h3>
<p>我们看一下它的代码（这个注解的写法，根据已有注解@NotNull，仿写而来），它实现的是对手机号码的验证</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Target</span><span style="color:#f92672">({</span>ElementType<span style="color:#f92672">.</span><span style="color:#a6e22e">FIELD</span><span style="color:#f92672">,</span> ElementType<span style="color:#f92672">.</span><span style="color:#a6e22e">ANNOTATION_TYPE</span><span style="color:#f92672">,</span> ElementType<span style="color:#f92672">.</span><span style="color:#a6e22e">CONSTRUCTOR</span><span style="color:#f92672">,</span> ElementType<span style="color:#f92672">.</span><span style="color:#a6e22e">PARAMETER</span><span style="color:#f92672">})</span>
<span style="color:#a6e22e">@Retention</span><span style="color:#f92672">(</span>RetentionPolicy<span style="color:#f92672">.</span><span style="color:#a6e22e">RUNTIME</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@Documented</span>
<span style="color:#a6e22e">@Constraint</span><span style="color:#f92672">(</span>
        validatedBy <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>IsMobileValidator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">}</span>
<span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">@interface</span> IsMobile <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">required</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
	
	<span style="color:#75715e">//以下三条语句，足矣
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//我们在其中添加错误信息
</span><span style="color:#75715e"></span>    String <span style="color:#a6e22e">message</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#34;手机号码格式错误&#34;</span><span style="color:#f92672">;</span>

    Class<span style="color:#f92672">&lt;?&gt;[]</span> groups<span style="color:#f92672">()</span> <span style="color:#66d9ef">default</span> <span style="color:#f92672">{};</span>

    Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Payload<span style="color:#f92672">&gt;[]</span> <span style="color:#a6e22e">payload</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">default</span> <span style="color:#f92672">{};</span>
<span style="color:#f92672">}</span>
123456789101112131415161718
</code></pre></div><ul>
<li><code>@Target</code>：表示的是能够标注的范围</li>
<li><code>@Constraint</code>：这个注解帮助我们处理逻辑，其中有<code>IsMobileValidator.class</code>是真正处理逻辑的类，我们看看它的代码</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsMobileValidator</span> <span style="color:#66d9ef">implements</span> ConstraintValidator<span style="color:#f92672">&lt;</span>IsMobile<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> required <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isValid</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">,</span> ConstraintValidatorContext constraintValidatorContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>required<span style="color:#f92672">){</span>
            <span style="color:#75715e">//在必须有值的情况下
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> ValidatorUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">isMobile</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//在不要求有值的情况下
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span>s<span style="color:#f92672">)){</span>
                <span style="color:#75715e">//空值是允许的
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//有值就给它判断判断
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> ValidatorUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">isMobile</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initialize</span><span style="color:#f92672">(</span>IsMobile constraintAnnotation<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        required <span style="color:#f92672">=</span> constraintAnnotation<span style="color:#f92672">.</span><span style="color:#a6e22e">required</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
1234567891011121314151617181920212223242526
</code></pre></div><ul>
<li>先看类的声明部分，public class IsMobileValidator implements <code>ConstraintValidator</code>，它有两个泛型，第一个是<code>自定义的注解类</code>，第二个是要<code>验证的参数类型</code>，另外实现该接口的逻辑类，<code>被spring管理成bean</code>，可以在需要的地方进行装配</li>
<li>其中有一个<code>initialize</code>，初始化方法，它调用的是我们自定义注解中写的<code>required()</code>方法，默认需要有值</li>
<li>另一个方法<code>isValid</code>，则对逻辑进行验证，true验证通过，false验证失败</li>
</ul>
<hr>
<h2 id="5-全局异常处理器">5. 全局异常处理器</h2>
<h3 id="51-我们为什么要引入全局异常处理器">5.1 我们为什么要引入全局异常处理器？</h3>
<ul>
<li>一边想，一边看一下下面这个方法</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">public</span> CodeMsg <span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>LoginVo loginVo<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>loginVo <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            <span style="color:#66d9ef">return</span> CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">SERVER_ERROR</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        String mobile <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getMobile</span><span style="color:#f92672">();</span>
        String password <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//判断手机号是否存在
</span><span style="color:#75715e"></span>        MiaoShaUser user <span style="color:#f92672">=</span> getById<span style="color:#f92672">(</span>Long<span style="color:#f92672">.</span><span style="color:#a6e22e">parseLong</span><span style="color:#f92672">(</span>mobile<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>user <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            <span style="color:#66d9ef">return</span> CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">MOBILE_NOT_EXIST</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//验证密码
</span><span style="color:#75715e"></span>        String DBPass <span style="color:#f92672">=</span> user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//这里对前端来的密码第二次MD5处理
</span><span style="color:#75715e"></span>        String formPassToDBPass <span style="color:#f92672">=</span> MD5Util<span style="color:#f92672">.</span><span style="color:#a6e22e">formPassToDBPass</span><span style="color:#f92672">(</span>password<span style="color:#f92672">,</span> user<span style="color:#f92672">.</span><span style="color:#a6e22e">getSalt</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>formPassToDBPass<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>DBPass<span style="color:#f92672">)){</span>
            <span style="color:#66d9ef">return</span> CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">PASSWORD_ERROR</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">SUCCESS</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
1234567891011121314151617181920212223
</code></pre></div><p>它的返回值是CodeMsg，而在业务中，方法对应的返回值应该是<code>确切的</code>，我们登陆，返回应该为 true 或 false，所以，我们要对这里进行优化</p>
<h3 id="52-优化">5.2 优化</h3>
<p>代码如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>LoginVo loginVo<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>loginVo <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GlobalException<span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">SERVER_ERROR</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        String mobile <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getMobile</span><span style="color:#f92672">();</span>
        String password <span style="color:#f92672">=</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//判断手机号是否存在
</span><span style="color:#75715e"></span>        MiaoShaUser user <span style="color:#f92672">=</span> getById<span style="color:#f92672">(</span>Long<span style="color:#f92672">.</span><span style="color:#a6e22e">parseLong</span><span style="color:#f92672">(</span>mobile<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>user <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GlobalException<span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">MOBILE_NOT_EXIST</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//验证密码
</span><span style="color:#75715e"></span>        String DBPass <span style="color:#f92672">=</span> user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//这里对前端来的密码第二次MD5处理
</span><span style="color:#75715e"></span>        String formPassToDBPass <span style="color:#f92672">=</span> MD5Util<span style="color:#f92672">.</span><span style="color:#a6e22e">formPassToDBPass</span><span style="color:#f92672">(</span>password<span style="color:#f92672">,</span> user<span style="color:#f92672">.</span><span style="color:#a6e22e">getSalt</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>formPassToDBPass<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>DBPass<span style="color:#f92672">)){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> GlobalException<span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">PASSWORD_ERROR</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
1234567891011121314151617181920212223
</code></pre></div><p>我们可以发现，对应的参数验证，并没有返回值，而是直接<code>抛出异常</code>，而且我们也将<code>返回值进行了修改</code>，执行到方法的最后，能够返回ture</p>
<h3 id="53-全局异常">5.3 全局异常</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalException</span> <span style="color:#66d9ef">extends</span> RuntimeException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> CodeMsg codeMsg<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">GlobalException</span><span style="color:#f92672">(</span>CodeMsg codeMsg<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">codeMsg</span> <span style="color:#f92672">=</span> codeMsg<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> CodeMsg <span style="color:#a6e22e">getCodeMsg</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> codeMsg<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
1234567891011
</code></pre></div><ul>
<li>全局异常就比较简单了，它<code>继承了RuntimeException类</code>，其中包含我们需要返回的信息CodeMsg的字段</li>
</ul>
<h3 id="54-全局异常处理器">5.4 全局异常处理器</h3>
<p>这个处理器可就值得说一说了！</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@ControllerAdvice</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> Exception<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Result<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">exceptionHandler</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span>Exception e<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>e <span style="color:#66d9ef">instanceof</span> GlobalException<span style="color:#f92672">){</span>
            GlobalException ge <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>GlobalException<span style="color:#f92672">)</span> e<span style="color:#f92672">;</span>

            CodeMsg codeMsg <span style="color:#f92672">=</span> ge<span style="color:#f92672">.</span><span style="color:#a6e22e">getCodeMsg</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>codeMsg<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>e <span style="color:#66d9ef">instanceof</span> BindException<span style="color:#f92672">){</span>
            <span style="color:#75715e">//获取错误列表，拿取其中的第一个
</span><span style="color:#75715e"></span>            BindException be <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>BindException<span style="color:#f92672">)</span> e<span style="color:#f92672">;</span>
            List<span style="color:#f92672">&lt;</span>ObjectError<span style="color:#f92672">&gt;</span> allErrors <span style="color:#f92672">=</span> be<span style="color:#f92672">.</span><span style="color:#a6e22e">getAllErrors</span><span style="color:#f92672">();</span>
            ObjectError error <span style="color:#f92672">=</span> allErrors<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>

            String message <span style="color:#f92672">=</span> error<span style="color:#f92672">.</span><span style="color:#a6e22e">getDefaultMessage</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">BIND_ERROR</span><span style="color:#f92672">.</span><span style="color:#a6e22e">fillArgs</span><span style="color:#f92672">(</span>message<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> Result<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>CodeMsg<span style="color:#f92672">.</span><span style="color:#a6e22e">SERVER_ERROR</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
12345678910111213141516171819202122232425
</code></pre></div><ul>
<li><code>@ControllerAdvice</code>：它是增强的Controller，能够实现<code>全局异常处理</code>和全局数据绑定</li>
<li>配合<code>@ExceptionHandler(value = Exception.class)</code>，它能够实现对所有异常的接受，而在方法中，对不同的异常进行处理</li>
</ul>
<hr>
<h2 id="6-关注一下参数替换的方法">6. 关注一下参数替换的方法</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> CodeMsg BIND_ERROR <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CodeMsg<span style="color:#f92672">(</span>500101<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;参数校验异常：%s&#34;</span><span style="color:#f92672">);</span>
   
    <span style="color:#66d9ef">public</span> CodeMsg <span style="color:#a6e22e">fillArgs</span><span style="color:#f92672">(</span>Object<span style="color:#f92672">...</span> args<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">int</span> code <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">code</span><span style="color:#f92672">;</span>
        String message <span style="color:#f92672">=</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">msg</span><span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CodeMsg<span style="color:#f92672">(</span>code<span style="color:#f92672">,</span>message<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
1234567
</code></pre></div><ul>
<li>其中<code>String.format()</code>能够根据传入的字符串格式，比如&quot;参数校验异常：%s&quot;，其中<code>%s</code>，能被第二个传入的参数进行替换，从而形成<code>动态的字符串</code></li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://kayleh.top">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://kayleh.top/js/github-style.js"></script>



</html>